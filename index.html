// Inicializa Firebase
const firebaseConfig = {
  apiKey: "AIzaSyCdB4pI610z1rplKmfAHct7CmGD0vmBg3U",
  authDomain: "almoxarifadobotucatu-5e03d.firebaseapp.com",
  projectId: "almoxarifadobotucatu-5e03d",
  storageBucket: "almoxarifadobotucatu-5e03d.firebasestorage.app",
  messagingSenderId: "828951000388",
  appId: "1:828951000388:web:06dbe3cb5764872e7b1311"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// LOGIN
loginForm.addEventListener("submit", async function(e){
  e.preventDefault();
  const username = document.getElementById("username").value.trim();
  const password = passwordInput.value.trim();

  try {
    const doc = await db.collection("usuarios").doc(username).get();
    if(doc.exists && doc.data().senha === password){
      sessionStorage.setItem("logado", "true");
      localStorage.setItem("usuarioLogado", username);
      window.location.href = "/central-de-pedidos/";
    } else {
      alert("Usuário ou senha inválidos!");
    }
  } catch(err){
    alert("Erro ao acessar o Firebase: " + err);
  }
});

// TROCAR SENHA
savePasswordBtn.addEventListener("click", async ()=>{
  const usuario = document.getElementById("modalUsername").value.trim();
  const currentPass = document.getElementById("currentPassword").value.trim();
  const newPass = document.getElementById("newPassword").value.trim();

  if(!usuario || !currentPass || !newPass){ alert("Preencha todos os campos"); return; }

  try {
    const doc = await db.collection("usuarios").doc(usuario).get();
    if(!doc.exists){ alert("Usuário não encontrado"); return; }
    if(doc.data().senha !== currentPass){ alert("Senha atual incorreta"); return; }

    await db.collection("usuarios").doc(usuario).set({ senha: newPass }, { merge:true });
    alert("Senha alterada com sucesso!");
    modal.style.display="none";
    document.getElementById("modalUsername").value="";
    document.getElementById("currentPassword").value="";
    document.getElementById("newPassword").value="";
  } catch(err){
    alert("Erro ao acessar o Firebase: " + err);
  }
});
