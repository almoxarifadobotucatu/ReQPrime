<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Painel de Controle</title>
<link rel="icon" type="image/png" sizes="32x32" href="">

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

<style>
  :root {
    --primary-color: #0a66c2;
    --primary-hover: #004182;
    --background: #16213e;
    --background-dark: #1a1a2e;
    --text: #fff;
    --text-light: #b8b8b8;
    --border: #2a2a3a;
  }
  body { font-family:'Inter',sans-serif; background:var(--background-dark); color:var(--text); margin:0; padding:0;}
  .container { max-width:900px; margin:50px auto; padding:20px; background:var(--background); border-radius:20px;}
  h2 { text-align:center; margin-bottom:20px;}
  label { display:block; margin-top:15px; color:var(--text-light);}
  input { width:100%; padding:12px; margin-top:5px; border-radius:10px; border:1px solid var(--border); background: rgba(255,255,255,0.05); color:var(--text);}
  button { padding:10px 20px; margin:10px 0; border:none; border-radius:10px; background:var(--primary-color); color:#fff; cursor:pointer;}
  button:hover { background:var(--primary-hover);}
  .senha-container { position:relative; }
  .senha-container span { position:absolute; right:15px; top:50%; transform:translateY(-50%); cursor:pointer; }
  .buttons { display:flex; gap:10px; margin-top:15px; flex-wrap:wrap; justify-content:center; }
</style>
</head>
<body>

<!-- Login -->
<div class="container" id="loginContainer">
  <h2>Login Admin</h2>
  <form id="loginForm">
    <label>Email:</label>
    <input type="email" id="email" required>
    
    <label>Senha:</label>
    <div class="senha-container">
      <input type="password" id="senha" required>
      <span id="toggleSenha">üëÅÔ∏è</span>
    </div>

    <button type="submit">Entrar</button>
  </form>
</div>

<!-- Painel -->
<div class="container" id="painelContainer" style="display:none;">
  <h2>Painel de Controle</h2>
  
  <div class="buttons">
    <button id="cadastrarBtn">Cadastrar Usu√°rio</button>
    <button id="menuBtn">Menu</button>
    <button id="logoutBtn">Sair</button>
  </div>

  <!-- Formul√°rio de cadastro -->
  <div id="cadastroFormContainer" style="margin-top:20px; display:none;">
    <h3>Cadastrar Usu√°rio</h3>
    <form id="cadastroForm">
      <label>Nome:</label>
      <input type="text" id="nome" required>
      
      <label>Email:</label>
      <input type="email" id="emailCadastro" required>
      
      <label>Senha:</label>
      <input type="password" id="senhaCadastro" required>
      
      <label>Admin:</label>
      <input type="checkbox" id="adminCadastro">
      
      <button type="submit">Cadastrar</button>
    </form>
  </div>
</div>

<script>
  // Configura√ß√£o Firebase
  const firebaseConfig = {
    apiKey: "AIzaSyCdB4pI610z1rplKmfAHct7CmGD0vmBg3U",
    authDomain: "almoxarifadobotucatu-5e03d.firebaseapp.com",
    projectId: "almoxarifadobotucatu-5e03d",
    storageBucket: "almoxarifadobotucatu-5e03d.firebasestorage.app",
    messagingSenderId: "828951000388",
    appId: "1:828951000388:web:06dbe3cb5764872e7b1311"
  };
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();

  // Toggle senha
  const senhaInput = document.getElementById("senha");
  const toggleSenha = document.getElementById("toggleSenha");
  toggleSenha.addEventListener("click", () => {
    if (senhaInput.type === "password") {
      senhaInput.type = "text";
      toggleSenha.textContent = "üôà";
    } else {
      senhaInput.type = "password";
      toggleSenha.textContent = "üëÅÔ∏è";
    }
  });

  // Elementos
  const loginContainer = document.getElementById("loginContainer");
  const painelContainer = document.getElementById("painelContainer");

  // Login
  document.getElementById("loginForm").addEventListener("submit", async (e)=>{
    e.preventDefault();
    const email = document.getElementById("email").value;
    const senha = document.getElementById("senha").value;

    try {
      const userCredential = await auth.signInWithEmailAndPassword(email, senha);
      const uid = userCredential.user.uid;
      const doc = await db.collection("usuarios").doc(uid).get();
      if(doc.exists && doc.data().admin){
        loginContainer.style.display = "none";
        painelContainer.style.display = "block";
      } else {
        alert("‚ö†Ô∏è Apenas administradores podem acessar!");
        auth.signOut();
      }
    } catch(err){
      alert("Erro: " + err.message);
    }
  });

  // Logout
  document.getElementById("logoutBtn").addEventListener("click", ()=>{
    auth.signOut();
    painelContainer.style.display="none";
    loginContainer.style.display="block";
  });

  // Abrir cadastro
  document.getElementById("cadastrarBtn").addEventListener("click", ()=>{
    document.getElementById("cadastroFormContainer").style.display="block";
  });

  // Redirecionar para menu
  document.getElementById("menuBtn").addEventListener("click", ()=>{
    window.location.href="https://almoxarifadobotucatu.netlify.app/paineldecontrole/menu";
  });

  // Cadastro de usu√°rio
  document.getElementById("cadastroForm").addEventListener("submit", async (e)=>{
    e.preventDefault();
    const nome = document.getElementById("nome").value;
    const email = document.getElementById("emailCadastro").value;
    const senha = document.getElementById("senhaCadastro").value;
    const admin = document.getElementById("adminCadastro").checked;

    try {
      const novoUser = await auth.createUserWithEmailAndPassword(email, senha);
      await db.collection("usuarios").doc(novoUser.user.uid).set({
        nome: nome,
        admin: admin
      });
      alert("Usu√°rio cadastrado com sucesso!");
      document.getElementById("cadastroForm").reset();
    } catch(err){
      alert("Erro: " + err.message);
    }
  });
</script>
</body>
</html>
