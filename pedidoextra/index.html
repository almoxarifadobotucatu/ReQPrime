<!DOCTYPE html>

<html lang="pt-BR">
<head>
  <script>
    // Redireciona imediatamente se tentar acessar direto
    if (document.referrer === "" || document.referrer === window.location.href) {
      window.location.replace("https://almoxarifadobotucatu.netlify.app/");
    }
  
function preencherUnidadeControle(itemSelecionado, unidadeControleInput) {
    // Captura a unidade da string (ex: "unidade: Comprimido")
    const match = itemSelecionado.match(/unidade:\s*([A-Za-zÀ-ú]+)/i);
    if (match) {
        unidadeControleInput.value = match[1]; // Ex: "Comprimido"
    } else {
        unidadeControleInput.value = "";
    }
}


    // Função para preparar a exibição sem "unidade: ..."
    function formatarItemParaExibicao(item) {
      return item.replace(/unidade:\s*[A-Za-zÀ-ú]+/i, "").trim();
    }

    // Preencher datalist ocultando "unidade: ..."
    function carregarListaItens(lista, datalistId = "lista-itens") {
      const dataList = document.getElementById(datalistId);
      if (!dataList) return;
      dataList.innerHTML = "";
      lista.forEach(item => {
        const option = document.createElement("option");
        option.value = formatarItemParaExibicao(item); // exibe sem unidade
        option.dataset.itemCompleto = item; // guarda o original com unidade
        dataList.appendChild(option);
      });
    }

    // Quando selecionar, ainda captura a unidade corretamente
    function preencherUnidadeControle(itemSelecionado, unidadeControleInputId = "unidadeControle") {
      const options = [...document.querySelectorAll("#lista-itens option")];
      const option = options.find(opt => opt.value === itemSelecionado);
      const itemOriginal = option ? option.dataset.itemCompleto : itemSelecionado;
      const match = itemOriginal.match(/unidade:\s*([A-Za-zÀ-ú]+)/i);
      const unidadeInput = document.getElementById(unidadeControleInputId);
      if (unidadeInput) unidadeInput.value = match ? match[1] : "";
    }

</script>

<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>

  <link rel="icon" type="image/png" href="data:image/png;base64,...#v2">

<title>Solicitação de Pedido Extra</title>
  <link rel="icon" type="image/png" sizes="32x32" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAGtElEQVR4nMWXf2yV5RXHP8/7vve2vfcW0hbLGD9m+FEZUF3GGBRWmMgPldIwBJZBGDICQwlRBKc1mTj3i9AGx5iKmUbnBKXMGNkYxAJbZwWsFBQswYhbNjcyoKX0x6W9977Pc/bH895yu1RXYcu+yZu8eX8853vO+Z7znAeuDS7gBPdexv3/FCowrABcB7auJctRvZL6rxv2AJQC1wXXZQbwGvAXYHNBLjc5To/vu4leD5xgIZSCVWVEgKXAW4BM/wry8N3I8MEI0AnsAEpVT8vetRDpDqWjYOhQPg88DHyYHUa+NQup3Y6Wenw5gW49QGrn48idJUgkGwEOAQurNxJWV033SSfd5B0H8qIUA9uA5oH5yPrFyJlX8KUBLUeRKwcRU4fIe0iiDrPpXnzAZIeRkIcAjcD944sYkEGkTxqZAbwKpL54I7LlPuTiPlJyAm3qrGF5G5HjSOPLyMp5CCCei6xdhHzwCn7jTvw1C5C8XAT4J1AJ3PRJBp3A8yKleMt1kDsmIfu3Isk6UvIOJlmLdP0BkWOI1CMHf4HcXmINF+YhP7kHOf97RE4gcgSRw4gcQ1/Yj//0Q0jRUEQpupRiOxAiQxfp3PjABEcxWRtSzR04IjhK8FAQikG8DXbtgaodcOojuHkk/PoxWDgdsvqBdEBHM7gKciKkM0nSR5ra8UXIchQrBB4BLgUkBMALcrSwIIq/ZzX+7NHWu88VIlvuR36+Dhn9BUSBzJqIHNhmIyHHkWQt0l4TROgdRBqQky8h3ylHcBEH5KHbMZXfwAAXh/UnL0Nztr7TD4zgzhmLnjsZGj+CJ2rgwZ+Bxtb/nkoomw90QtcF8DVkZ0GsAEhCzWHY/DIcOAqDYlA5D5ZPhoKh8PpB2x/69wdae+a/By53gumAsYPh2e/CuSqoXAAjBsC8CpizDP5YC9lRiBVCSsPzr8GYJTDrPrj0MexaCX+vhA1zoSAb/FboTPUuQO/fH7iOTZ5OAAkojMGGMrh3Kuw6BlX74dY1MGEclH4JXtgLl1qgvBh++SBMGR24dQX8dhCBkGt7Sp8IdIdG2Q4oPuh2iHiw/FZYPhUONsKm38Fzu2DZZFg7E0YOAXxIxcGIdQRAC4TEqk0B2vTsjJ9IIA2lwFPWE9Nhid1WDLeNA90JbgxIQqoVPNdWjP0hMKABV1CWhJMTRn8mAt1EyPAqHmxMjo2OEQhFwU8p9tULtSeFc82QmwNfLoLyryqz6GvinjnP5o17aZNqXLXIEukzgUykiUjgZSgGdR8o1j4rvNusYMQNtgzak/B6ExXVXVTdDY9+n2Mb9wKNPRvRNUMMuBGoeU9RtlVIlgzDrShBFeVb5RmBi3FafvU+K55p4IHd3IWSN9QP0gm6jgFCBFQILlxWLH5KSM4cgffSXPSoAvy4j9+SwG9N4kfCqEdLXeenX9etcVlFyL2LoLVcFwEtoHIUT+4TmrIihH48DT+uoS1hleoqu3rIRT5uxSy9BTVnlJDUjyHVLmB6JaCNjdx/guuAJBV73gZ150jMDVHQGvKy7QLaQEEEtjfA/N3QlnDlm2MBxhFeMgZbJ04mAaXAz49hnLD9X5vejYuAcqC9Q/hHO8i4AoxS0NQJb/4NIiEYEIFt9faaP9rW6JB+hkgIUqlRgQwtARFwXfz2BN4DvyF09hzay8W4OfadNvCpQTECWR78+TKs+C3sOAXPvQtVR2BDib26Uhkjz1U4WEEoralJaSqeOMTZ4sdxlzyNU3cGo7LQbhRRgG8C75WtgNyYYnAuqNOXcDpTMGUIrC+BH70JP/yTvV8zAc7HIezBX1sd4ikIhT4MPDJOkAsB2oBNZeO5pSvFt3fWc7i0Cmd6Fe7uoyit8L0YolwbkZQGFRbKJ4LsPSvqYlwwwOrx8L3J9lozAZquWK+jIU31aYD3Se44HcTCZAYkPU77Kp0cxQytuQcoHzMIb2UpLJuEn5ePQwIHgQtxJTc/Iur8tJE4T802JmEcPMe61J6AsAsDcgwvntRUHAoRdheQ1K8GtnRve5QKUmMAcR3ol0NxS5xVwOKB/chfOhFWT0XfmIdxo4TeOK5a7tgmUTVtWFivL9GMyBfCwaTXFIcXT3lsbwDYArIescY/TVZp9BzRC66O6NEwUjQQmT2GIyIM9LK9KcAJlBKKC4WZw4WSIUL/bAGagXUZa35m9DikrJtEDrAMeBIY3v3VxmkeMBeowh5UngFWMSwyKGOd60KPY5oT7Igi3WkLEhh0QjcYKix69fxaz29pgwqrFdPL8/QMAjbffeiv/wf8C5QItWJWN/CxAAAAAElFTkSuQmCC">
<style>
    :root {
      --primary-extra-color: #1db954;
      --danger-extra-color: #ff6b6b;
      --primary-color: #0a66c2;
      --primary-hover-color: #004182;
      --danger-color: #e53e3e;
      --danger-hover-color: #c53030;
      --background-light: #1a1a2e;
      --background-white: #16213e;
      --text-dark: #ffffff;
      --text-medium: #b8b8b8;
      --border-light: #2a2a3a;
      --shadow-light: 0 4px 6px -1px rgba(0, 0, 0, 0.3), 0 2px 4px -1px rgba(0, 0, 0, 0.2);
      --transition-all: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    body {
      background-color: var(--background-light);
      font-family: 'Inter', sans-serif;
      margin: 0;
      padding: 20px;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
      box-sizing: border-box;
      color: var(--text-dark);
    }

    .container, .login-container, .change-password-container {
      max-width: 800px;
      width: 100%;
      background-color: var(--background-white);
      margin: 40px auto;
      padding: 50px;
      border-radius: 20px;
      box-shadow: var(--shadow-light);
      transition: var(--transition-all);
    }

    .container:hover, .login-container:hover, .change-password-container:hover {
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3), 0 4px 6px -2px rgba(0, 0, 0, 0.2);
    }

    h2 {
      text-align: center;
      color: var(--text-dark);
      margin-bottom: 40px;
      font-weight: 700;
      font-size: 1.5rem;
      letter-spacing: -0.025em;
    }

    label {
      display: block;
      margin-top: 25px;
      color: var(--text-medium);
      font-weight: 500;
      margin-bottom: 8px;
      font-size: 0.95rem;
    }

    input[type="text"],
    input[type="number"],
    input[type="password"] {
      width: 100%;
      padding: 14px 18px;
      border: 1px solid var(--border-light);
      border-radius: 12px;
      box-sizing: border-box;
      font-size: 1rem;
      color: var(--text-dark);
      background-color: rgba(255, 255, 255, 0.1);
      transition: var(--transition-all);
    }

    input[type="text"]:focus,
    input[type="number"]:focus,
    input[type="password"]:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 4px rgba(10, 102, 194, 0.3);
      background-color: rgba(255, 255, 255, 0.15);
    }

    input:-webkit-autofill {
      -webkit-box-shadow: 0 0 0px 1000px rgba(255, 255, 255, 0.1) inset !important;
      -webkit-text-fill-color: var(--text-dark) !important;
      transition: background-color 5000s ease-in-out 0s;
    }

    input:-webkit-autofill:focus {
      -webkit-box-shadow: 0 0 0px 1000px rgba(255, 255, 255, 0.15) inset !important;
    }

    input:-internal-autofill-selected {
      background-color: rgba(255, 255, 255, 0.1) !important;
      color: var(--text-dark) !important;
    }

    .custom-select {
      position: relative;
      width: 100%;
    }

    .custom-select .selected {
      width: 100%;
      padding: 14px 18px;
      border: 1px solid var(--border-light);
      border-radius: 12px;
      box-sizing: border-box;
      font-size: 1rem;
      color: var(--text-dark);
      background-color: rgba(255, 255, 255, 0.1);
      transition: var(--transition-all);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .custom-select .selected::after {
      content: '▼';
      font-size: 0.8rem;
      color: var(--text-medium);
      margin-left: 10px;
    }

    .custom-select .selected:hover,
    .custom-select .selected:focus {
      border-color: var(--primary-color);
      box-shadow: 0 0 0 4px rgba(10, 102, 194, 0.3);
      background-color: rgba(255, 255, 255, 0.15);
    }

    .custom-select .options {
      position: absolute;
      top: 100%;
      left: 0;
      width: 100%;
      background-color: var(--background-white);
      border: 1px solid var(--border-light);
      border-radius: 12px;
      box-shadow: var(--shadow-light);
      max-height: 200px;
      overflow-y: auto;
      z-index: 10;
      display: none;
      margin-top: 4px;
      animation: fadeIn 0.3s ease-in-out;
    }

    .custom-select .options .option {
      padding: 12px 18px;
      color: var(--text-dark);
      cursor: pointer;
      transition: var(--transition-all);
      font-size: 1rem;
    }

    .custom-select .options .option:hover {
      background-color: rgba(255, 255, 255, 0.1);
    }

    .custom-select .options .option.selected {
      background-color: rgba(10, 102, 194, 0.2);
    }

    .setor {
      margin-top: 40px;
      padding: 30px;
      border: 1px solid var(--border-light);
      border-radius: 16px;
      background-color: rgba(0, 0, 0, 0.2);
      position: relative;
      box-shadow: var(--shadow-light);
      transition: var(--transition-all);
    }

    .setor:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3);
    }

    .setor > label {
      margin-top: 0;
    }

    .setor-select-group {
      display: flex;
      align-items: flex-end;
      gap: 20px;
    }

    .setor-select-group .custom-select {
      flex: 1;
    }

    .setor-select-group .remove-setor-
    /* Botões estilo Central de Pedidos */
    button {
      background: var(--primary-color);
      color: white;
      padding: 14px 30px;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      font-size: 1rem;
      font-weight: 600;
      transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1),
                  box-shadow 0.3s cubic-bezier(0.4, 0, 0.2, 1),
                  background 0.4s ease-in-out;
      box-shadow: var(--shadow-light);
    }

    button:hover {
      transform: translateY(-3px) scale(1.02);
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3);
      background: linear-gradient(270deg, var(--primary-color), var(--primary-hover-color), var(--primary-extra-color));
      background-size: 600% 600%;
      animation: gradientShift 6s ease infinite;
    }

    .remove-button {
      background: var(--danger-color);
    }

    .remove-button:hover {
      background: linear-gradient(270deg, var(--danger-color), var(--danger-hover-color), var(--danger-extra-color));
      background-size: 600% 600%;
      animation: gradientShift 6s ease infinite;
    }

    @keyframes gradientShift {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }


    .item {
  display: flex;
  flex-wrap: nowrap;
  gap: 15px;
  align-items: flex-end;
}

.item .item-input-group.item-nome-group {
  flex: 2;
  min-width: 250px;
}

.item .item-input-group.item-qtd-group {
  flex: 0 0 90px;
}

.item .item-input-group.item-unidade-group {
  flex: 0 0 140px;
}
.item .item-input-group.item-unidade-group select {
  width: 100%;
  padding: 10px 14px;
  border: 1px solid var(--border-light);
  border-radius: 12px;
  font-size: 0.9rem;
  background-color: rgba(255, 255, 255, 0.1);
  color: var(--text-dark);
}


.item .item-input-group.item-unidade-group select:focus {
  outline: none;
  border-color: var(--primary-color);
  box-shadow: 0 0 0 4px rgba(10, 102, 194, 0.3);
  background-color: rgba(255, 255, 255, 0.15);
}
.item .item-input-group.item-unidade-group select:focus {
  outline: none;
  border-color: var(--primary-color);
  box-shadow: 0 0 0 4px rgba(10, 102, 194, 0.3);
  background-color: rgba(255, 255, 255, 0.15);
}
      min-width: 120px;
      max-width: 150px;
      flex-grow: 1;
    }

    .item .item-input-group label {
      margin-top: 0;
      margin-bottom: 8px;
    }

    .item .item-input-group input {
      width: 100%;
      margin-top: 0;
    }

    .item .remove-item-
    /* Botões estilo Central de Pedidos */
    button {
      background: var(--primary-color);
      color: white;
      padding: 14px 30px;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      font-size: 1rem;
      font-weight: 600;
      transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1),
                  box-shadow 0.3s cubic-bezier(0.4, 0, 0.2, 1),
                  background 0.4s ease-in-out;
      box-shadow: var(--shadow-light);
    }

    button:hover {
      transform: translateY(-3px) scale(1.02);
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3);
      background: linear-gradient(270deg, var(--primary-color), var(--primary-hover-color), var(--primary-extra-color));
      background-size: 600% 600%;
      animation: gradientShift 6s ease infinite;
    }

    .remove-button {
      background: var(--danger-color);
    }

    .remove-button:hover {
      background: linear-gradient(270deg, var(--danger-color), var(--danger-hover-color), var(--danger-extra-color));
      background-size: 600% 600%;
      animation: gradientShift 6s ease infinite;
    }

    @keyframes gradientShift {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }


    .Justificativa-group {
      margin-top: 20px;
    }

    .Justificativa {
      width: 100%;
      padding: 8px;
      border: 1px solid #555;
      border-radius: 4px;
      font-size: 14px;
      resize: vertical;
      background-color: #333;
      color: #fff;
    }

    .Justificativa:focus {
      outline: none;
      border-color: #007bff;
      box-shadow: 0 0 5px rgba(0, 123, 255, 0.5);
    }

    .Justificativa:placeholder {
      color: #aaa;
    }

    .buttons {
      margin-top: 50px;
      text-align: center;
      display: flex;
      justify-content: center;
      gap: 20px;
    }

    
    /* Botões estilo Central de Pedidos */
    button {
      background: var(--primary-color);
      color: white;
      padding: 14px 30px;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      font-size: 1rem;
      font-weight: 600;
      transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1),
                  box-shadow 0.3s cubic-bezier(0.4, 0, 0.2, 1),
                  background 0.4s ease-in-out;
      box-shadow: var(--shadow-light);
    }

    button:hover {
      transform: translateY(-3px) scale(1.02);
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3);
      background: linear-gradient(270deg, var(--primary-color), var(--primary-hover-color), var(--primary-extra-color));
      background-size: 600% 600%;
      animation: gradientShift 6s ease infinite;
    }

    .remove-button {
      background: var(--danger-color);
    }

    .remove-button:hover {
      background: linear-gradient(270deg, var(--danger-color), var(--danger-hover-color), var(--danger-extra-color));
      background-size: 600% 600%;
      animation: gradientShift 6s ease infinite;
    }

    @keyframes gradientShift {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }


    .remove-
    /* Botões estilo Central de Pedidos */
    button {
      background: var(--primary-color);
      color: white;
      padding: 14px 30px;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      font-size: 1rem;
      font-weight: 600;
      transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1),
                  box-shadow 0.3s cubic-bezier(0.4, 0, 0.2, 1),
                  background 0.4s ease-in-out;
      box-shadow: var(--shadow-light);
    }

    button:hover {
      transform: translateY(-3px) scale(1.02);
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3);
      background: linear-gradient(270deg, var(--primary-color), var(--primary-hover-color), var(--primary-extra-color));
      background-size: 600% 600%;
      animation: gradientShift 6s ease infinite;
    }

    .remove-button {
      background: var(--danger-color);
    }

    .remove-button:hover {
      background: linear-gradient(270deg, var(--danger-color), var(--danger-hover-color), var(--danger-extra-color));
      background-size: 600% 600%;
      animation: gradientShift 6s ease infinite;
    }

    @keyframes gradientShift {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }


    .remove-button:hover {
      background: linear-gradient(135deg, var(--danger-hover-color), var(--danger-color));
    }

    .remove-setor-button:hover {
      transform: scale(1.05);
    }

    .item-buttons {
      margin-top: 25px;
      text-align: right;
    }

    .setor, .item {
      animation: fadeIn 0.5s ease-in-out;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .hidden {
      display: none;
    }

    @media (max-width: 768px) {
      .container, .login-container, .change-password-container {
        margin: 20px;
        padding: 30px;
      }
      .buttons {
        flex-direction: column;
        gap: 15px;
      }
      .setor-select-group {
        flex-direction: column;
        align-items: stretch;
      }
      .setor-select-group .remove-setor-
    /* Botões estilo Central de Pedidos */
    button {
      background: var(--primary-color);
      color: white;
      padding: 14px 30px;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      font-size: 1rem;
      font-weight: 600;
      transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1),
                  box-shadow 0.3s cubic-bezier(0.4, 0, 0.2, 1),
                  background 0.4s ease-in-out;
      box-shadow: var(--shadow-light);
    }

    button:hover {
      transform: translateY(-3px) scale(1.02);
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3);
      background: linear-gradient(270deg, var(--primary-color), var(--primary-hover-color), var(--primary-extra-color));
      background-size: 600% 600%;
      animation: gradientShift 6s ease infinite;
    }

    .remove-button {
      background: var(--danger-color);
    }

    .remove-button:hover {
      background: linear-gradient(270deg, var(--danger-color), var(--danger-hover-color), var(--danger-extra-color));
      background-size: 600% 600%;
      animation: gradientShift 6s ease infinite;
    }

    @keyframes gradientShift {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

      .item {
        flex-direction: column;
        align-items: stretch;
      }
      .item .item-input-group {
        min-width: unset;
        max-width: 100%;
      }
      .item .remove-item-
    /* Botões estilo Central de Pedidos */
    button {
      background: var(--primary-color);
      color: white;
      padding: 14px 30px;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      font-size: 1rem;
      font-weight: 600;
      transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1),
                  box-shadow 0.3s cubic-bezier(0.4, 0, 0.2, 1),
                  background 0.4s ease-in-out;
      box-shadow: var(--shadow-light);
    }

    button:hover {
      transform: translateY(-3px) scale(1.02);
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3);
      background: linear-gradient(270deg, var(--primary-color), var(--primary-hover-color), var(--primary-extra-color));
      background-size: 600% 600%;
      animation: gradientShift 6s ease infinite;
    }

    .remove-button {
      background: var(--danger-color);
    }

    .remove-button:hover {
      background: linear-gradient(270deg, var(--danger-color), var(--danger-hover-color), var(--danger-extra-color));
      background-size: 600% 600%;
      animation: gradientShift 6s ease infinite;
    }

    @keyframes gradientShift {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    }
  </style>
<style>
    .erro-campo {
      outline: 2px solid #ff4d4d !important;
      background-color: rgba(255, 0, 0, 0.08) !important;
      transition: background-color 0.2s ease;
    }
    #mensagensErros {
  display: none;
  margin: 20px 0;
  padding: 20px;
  border-radius: 10px;
  background-color: #ffe5e5;
  color: #600000;
  font-family: Arial, sans-serif;
  font-size: 15px;
  line-height: 1.5;
}

#mensagensErros h3 {
  margin: 0 0 10px 0;
  font-size: 17px;
  font-weight: bold;
  color: #a70000;
}

#mensagensErros strong {
  display: block;
  margin-top: 10px;
  color: #a70000;
  font-size: 15px;
}

#mensagensErros ul {
  margin: 5px 0 10px 25px;
  padding: 0;
  list-style-type: disc;
}

#mensagensErros li {
  margin-bottom: 4px;
}
  </style>
<style>
  #enviarPedido {
    display: none;
  }
</style>

<style>
  </style>


<script>
// --- Mensagens no topo (sem alert do navegador) ---
(function(){
  window.mostrarMensagemTopo = function(msgHTML, tipo) {
    try {
      var painel = document.getElementById('mensagensErros');
      if (!painel) return;
      painel.classList.remove('success');
      painel.classList.remove('erro');
      var isSuccess = (tipo === 'sucesso' || tipo === 'success');
      painel.classList.add(isSuccess ? 'success' : 'erro');
      if (typeof msgHTML === 'string') {
        painel.innerHTML = msgHTML;
      } else {
        painel.innerHTML = String(msgHTML);
      }
      painel.style.display = 'block';
      painel.scrollIntoView({ behavior: 'smooth', block: 'start' });
    } catch(e) { /* noop */ }
  };
  window.limparMensagensTopo = function() {
    var painel = document.getElementById('mensagensErros');
    if (painel) { painel.style.display = 'none'; painel.innerHTML = ''; painel.classList.remove('success','erro'); }
  };
})();
</script>

</head>
<body oncontextmenu="return false;">


<div class="container" id="mainContainer">
<h2>Solicitação de Pedido Extra</h2>
<div id="mensagensErros"></div>
<form id="pedidoForm" novalidate>
<label for="solicitante">Responsável pela solicitação:</label>
<input autocomplete="off" id="solicitante" required="" type="text"/>
<label for="unidade">Unidade de saúde:</label>
<input autocomplete="off" id="unidade" required="" type="text"/>
<div id="setoresContainer"></div>
<div class="buttons">
<button onclick="adicionarSetor()" type="button">Adicionar novo setor</button>
<button id="enviarPedido" type="button">Enviar pedido</button>
</div>
</form>
</div>
<datalist id="lista-itens"></datalist>
<script>
function pluralizarUnidade(unidade, quantidade) {
  const pluraisIrregulares = {
    "Ampola": "Ampolas",
    "Frasco": "Frascos",
    "Comprimido": "Comprimidos",
    "Cartela": "Cartelas",
    "Caixa": "Caixas",
    "Tubo": "Tubos",
    "Envelope": "Envelopes",
    "Bisnaga": "Bisnagas",
    "Gota": "Gotas",
    "Unidade": "Unidades",
    "Cápsula": "Cápsulas",
    "Sachê": "Sachês",
    "Drágea": "Drágeas",
    "Caneta": "Canetas",
    "Refil": "Refis", // pode não variar em alguns contextos, ajuste se necessário
    "UI": "UI",
    "ML": "ML",
    "MG": "MG",
    "L": "L"
  };
  if (Number(quantidade) > 1 && pluraisIrregulares[unidade]) {
    return pluraisIrregulares[unidade];
  }
  return unidade;
}

    // Initialize users from localStorage or use default
    let users = JSON.parse(localStorage.getItem('users')) || [
      { username: "sms6786", password: "Master1@" },
      { username: "admin", password: "master@" }
    ];
    // Ensure all usernames are lowercase
    users = users.map(user => ({
      username: user.username.toLowerCase(),
      password: user.password
    }));
    localStorage.setItem('users', JSON.stringify(users));

<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <script>
    // Redireciona imediatamente se tentar acessar direto
    if (document.referrer === "" || document.referrer === window.location.href) {
      window.location.replace("https://almoxarifadobotucatu.netlify.app/");
    }

    // Função para preparar a exibição sem "unidade: ..."
    function formatarItemParaExibicao(item) {
      return item.replace("unidade:", "").trim();
    }

    // Preencher datalist ocultando "unidade: ..."
    function carregarListaItens(lista, datalistId = "lista-itens") {
      const dataList = document.getElementById(datalistId);
      if (!dataList) return;
      dataList.innerHTML = "";
      lista.forEach(item => {
        const option = document.createElement("option");
        option.value = formatarItemParaExibicao(item); // exibe sem "unidade:"
        option.dataset.itemCompleto = item; // guarda o original com unidade
        dataList.appendChild(option);
      });
    }

    // Quando selecionar, ainda captura a unidade corretamente
    function preencherUnidadeControle(itemSelecionado, unidadeControleInputId = "unidadeControle") {
      const options = [...document.querySelectorAll("#lista-itens option")];
      const option = options.find(opt => opt.value === itemSelecionado);
      const itemOriginal = option ? option.dataset.itemCompleto : itemSelecionado;
      const match = itemOriginal.match(/unidade:\s*([A-Za-zÀ-ú]+)/i);
      const unidadeInput = document.getElementById(unidadeControleInputId);
      if (unidadeInput) unidadeInput.value = match ? match[1] : "";
    }

    // Lista de exemplo (apenas alguns itens)
    const farmaciaItems = [
      "1 01 01 0001 4 Alopurinol 100mg unidade: Comprimido",
      "1 01 06 0001 7 Aciclovir 200mg unidade: Comprimido",
      "1 01 20 0030 0 Ácido Acético 3% - Frasco 10ML – Manipulado unidade: Frasco"
    ];

    // Carregar lista automaticamente ao abrir a página
    window.addEventListener("DOMContentLoaded", () => {
      carregarListaItens(farmaciaItems);
    });
  </script>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <title>Solicitação de Pedido Extra</title>
</head>
<body>
  <div class="container" id="mainContainer">
    <h2>Solicitação de Pedido Extra</h2>
    <form id="pedidoForm" novalidate>
      <label for="solicitante">Responsável pela solicitação:</label>
      <input autocomplete="off" id="solicitante" required type="text"/>

      <label for="unidade">Unidade de saúde:</label>
      <input autocomplete="off" id="unidade" required type="text"/>

      <div id="setoresContainer"></div>

      <div class="buttons">
        <button onclick="adicionarSetor()" type="button">Adicionar novo setor</button>
        <button id="enviarPedido" type="button">Enviar pedido</button>
      </div>
    </form>
  </div>

  <datalist id="lista-itens"></datalist>
</body>
</html>


    function updateDatalist(setorId, sectorValue) {
      const datalist = document.getElementById('lista-itens');
      datalist.innerHTML = '';
      let items;
      if (sectorValue === 'Farmácia') {
        items = farmaciaItems;
      } else if (sectorValue === 'Psicotrópico') {
        items = PsicotópicoItems;
      } else if (sectorValue === 'Enfermagem') {
        items = enfermagemItems;
      } else if (sectorValue === 'Enfermagem_Urgência_e_Emergência') {
        items = Enfermagem_Urgência_e_EmergênciaItems;
      } else if (sectorValue === 'Enfermagem_Teste_DST') {
        items = Enfermagem_Teste_DSTItems;
      } else if (sectorValue === 'Odonto') {
        items = OdontoItems;
      } else if (sectorValue === 'Odonto_Instrumental') {
        items = Odonto_InstrumentalItems;
      } else if (sectorValue === 'Impressos') {
        items = ImpressosItems;
      } else if (sectorValue === 'Escritório') {
        items = EscritórioItems;
      } else if (sectorValue === 'Consumo_e_Limpeza_Esporádicos') {
        items = Consumo_e_Limpeza_EsporádicosItems;
      } else if (sectorValue === 'Consumo_e_Limpeza_Periódico') {
        items = Consumo_e_Limpeza_PeriódicoItems;
      } else if (sectorValue === 'Epi_Consumo') {
        items = Epi_ConsumoItems;
      } else {
        items = defaultItems;
      }
      items.forEach(item => {
        const option = document.createElement('option');
        // Texto exibido sem "unidade: ..."
        const display = item.replace(/\s*unidade:\s*[^,\n]+/i, '').trim();
        option.value = display;                   // o usuário vê o texto limpo
        option.dataset.original = item;           // guardamos o original para usar no formulário
        datalist.appendChild(option);
      });
    }

    document.addEventListener('contextmenu', function(e) {
      e.preventDefault();
      return false;
    });

    document.addEventListener('keydown', function(e) {
      if (e.keyCode === 123 || (e.ctrlKey && e.shiftKey && (e.keyCode === 73 || e.keyCode === 74)) || (e.ctrlKey && e.keyCode === 85)) {
        e.preventDefault();
        return false;
      }
    });

    let setorIndex = 0;

    function adicionarSetor() {

      // Exibe o botão Enviar Pedido assim que um setor for adicionado
      document.getElementById("enviarPedido").style.display = "inline-block";

      const setores = document.querySelectorAll('.setor input[name="setor"]');
      const setoresSelecionados = Array.from(setores).map(input => input.value.trim());
      const container = document.getElementById('setoresContainer');
      const div = document.createElement('div');
      div.className = 'setor';
      div.setAttribute('data-setor-index', setorIndex);
      const setorId = `setor-${setorIndex}`;
      div.innerHTML = `
        <label>Setor:</label>
        <div class="setor-select-group">
          <div class="custom-select" id="${setorId}">
            <div class="selected" onclick="toggleOptions('${setorId}')">Selecione um setor</div>
            <input type="hidden" name="setor" value="" required>
            <div class="options">
              <div class="option" data-value="Farmácia" onclick="selectOption('${setorId}', 'Farmácia')">Farmácia</div>
              <div class="option" data-value="Psicotrópico" onclick="selectOption('${setorId}', 'Psicotrópico')">Psicotrópico</div>
              <div class="option" data-value="Enfermagem" onclick="selectOption('${setorId}', 'Enfermagem')">Enfermagem</div>
              <div class="option" data-value="Enfermagem_Urgência_e_Emergência" onclick="selectOption('${setorId}', 'Enfermagem_Urgência_e_Emergência')">Enfermagem_Urgência_e_Emergência</div>
              <div class="option" data-value="Enfermagem_Teste_DST" onclick="selectOption('${setorId}', 'Enfermagem_Teste_DST')">Enfermagem_Teste_DST</div>
              <div class="option" data-value="Odonto" onclick="selectOption('${setorId}', 'Odonto')">Odonto</div>
              <div class="option" data-value="Odonto_Instrumental" onclick="selectOption('${setorId}', 'Odonto_Instrumental')">Odonto_Instrumental</div>
              <div class="option" data-value="Consumo_e_Limpeza_Esporádicos" onclick="selectOption('${setorId}', 'Consumo_e_Limpeza_Esporádicos')">Consumo_e_Limpeza_Esporádicos</div>
              <div class="option" data-value="Consumo_e_Limpeza_Periódico" onclick="selectOption('${setorId}', 'Consumo_e_Limpeza_Periódico')">Consumo_e_Limpeza_Periódico</div>
              <div class="option" data-value="Escritório" onclick="selectOption('${setorId}', 'Escritório')">Escritório</div>
              <div class="option" data-value="Impressos" onclick="selectOption('${setorId}', 'Impressos')">Impressos</div>
              <div class="option" data-value="Epi_Consumo" onclick="selectOption('${setorId}', 'Epi_Consumo')">Epi_Consumo</div>
            </div>
          </div>
          <button type="button" onclick="removerSetor(this)" class="remove-button remove-setor-button">Remover Setor</button>
        </div>
        <div class="itens" id="itens-${setorIndex}"></div>
        <div class="item-buttons">
          <button type="button" onclick="adicionarItem(${setorIndex})">Adicionar Item</button>
        </div>
        <div class="Justificativa-group">
          <label>Digite aqui uma justificativa para itens do setor acima:</label>
          <textarea class="Justificativa" maxlength="300" rows="3" placeholder="Digite sua justificativa..."></textarea>
        </div>
      `;
      container.appendChild(div);
      adicionarItem(setorIndex);
      setorIndex++;
    }

    function toggleOptions(setorId) {
      const options = document.querySelector(`#${setorId} .options`);
      options.style.display = options.style.display === 'block' ? 'none' : 'block';
    }

    function selectOption(setorId, value) {
      const setores = document.querySelectorAll('.setor input[name="setor"]');
      const setoresSelecionados = Array.from(setores).map(input => input.value.trim());
      if (setoresSelecionados.includes(value)) {
        mostrarMensagemTopo('Este setor já foi adicionado.');
        return;
      }
      const selected = document.querySelector(`#${setorId} .selected`);
      const hiddenInput = document.querySelector(`#${setorId} input[name="setor"]`);
      selected.textContent = value;
      hiddenInput.value = value;
      toggleOptions(setorId);
      updateDatalist(setorId, value);
      // Clear all item names and quantities in this sector
      const setor = document.querySelector(`#${setorId}`).closest('.setor');
      const itemInputs = setor.querySelectorAll('.item-nome');
      const quantityInputs = setor.querySelectorAll('.item-qtd');
      itemInputs.forEach(input => input.value = '');
      quantityInputs.forEach(input => input.value = '');
    }

    document.addEventListener('click', function(e) {
      if (!e.target.closest('.custom-select')) {
        document.querySelectorAll('.options').forEach(opt => opt.style.display = 'none');
      }
    });

    function removerSetor(button) {
      button.closest('.setor').remove();
      // Update datalist for the first remaining sector, if any
      const firstSetor = document.querySelector('.setor');
      if (firstSetor) {
        const setorId = firstSetor.querySelector('.custom-select').id;
        const sectorValue = firstSetor.querySelector('input[name="setor"]').value.trim();
        updateDatalist(setorId, sectorValue);
      } else {
        updateDatalist('setor-0', ''); // Clear datalist if no sectors remain
      }
    }

    function adicionarItem(index) {
      const container = document.getElementById(`itens-${index}`);
      const setor = container.closest('.setor');
      const nomeSetor = setor.querySelector('input[name="setor"]').value.trim();
      if (!nomeSetor) {
      }
      const itensExistentes = Array.from(container.querySelectorAll('.item-nome')).map(input => input.value.trim());
      const div = document.createElement('div');
      div.className = 'item';
      const count = container.querySelectorAll('.item').length;
      const unidadeId = `unidade-${index}-${count+1}`;
      div.innerHTML = `
        <div class="item-input-group item-nome-group">
          <label>Item:</label>
          <input type="text" class="item-nome" list="lista-itens" required onchange="verificarDuplicata(this, '${index}')">
        </div>
        <div class="item-input-group item-qtd-group">
          <label>Quantidade:</label>
          <input type="number" class="item-qtd" min="1" required>
        </div>
        
<div class="item-input-group item-unidade-group">
  <label>Unidade de Controle</label>
  <input type="text" class="unidade-controle" readonly />
</div>
    <input type="hidden" class="item-unidade" name="unidade" value="">
    <div class="options">
      <div class="option" data-value="Comprimido" onclick="selectOptionUnidade(\'${unidadeId}\', 'Comprimido')">Comprimido</div>
      <div class="option" data-value="Cápsula" onclick="selectOptionUnidade(\'${unidadeId}\', 'Cápsula')">Cápsula</div>
      <div class="option" data-value="Frasco" onclick="selectOptionUnidade(\'${unidadeId}\', 'Frasco')">Frasco</div>
      <div class="option" data-value="Ampola" onclick="selectOptionUnidade(\'${unidadeId}\', 'Ampola')">Ampola</div>
      <div class="option" data-value="Tubo" onclick="selectOptionUnidade(\'${unidadeId}\', 'Tubo')">Tubo</div>
      <div class="option" data-value="Refil" onclick="selectOptionUnidade(\'${unidadeId}\', 'Refil')">Refil</div>
      <div class="option" data-value="Sachê" onclick="selectOptionUnidade(\'${unidadeId}\', 'Sachê')">Sachê</div>
      <div class="option" data-value="Drágea" onclick="selectOptionUnidade(\'${unidadeId}\', 'Drágea')">Drágea</div>
      <div class="option" data-value="Caneta" onclick="selectOptionUnidade(\'${unidadeId}\', 'Caneta')">Caneta</div>
      <div class="option" data-value="Unidade" onclick="selectOptionUnidade(\'${unidadeId}\', 'Unidade')">Unidade</div>
      <div class="option" data-value="Cartela" onclick="selectOptionUnidade(\'${unidadeId}\', 'Cartela')">Cartela</div>
      <div class="option" data-value="Bisnaga" onclick="selectOptionUnidade(\'${unidadeId}\', 'Bisnaga')">Bisnaga</div>
      <div class="option" data-value="Envelope" onclick="selectOptionUnidade(\'${unidadeId}\', 'Envelope')">Envelope</div>
    </div>
  </div>
</div>
        <button type="button" onclick="removerItem(this)" class="remove-button remove-item-button">Remover</button>
      `;
      container.appendChild(div);
    }

    function verificarDuplicata(input, index) {
      const container = document.getElementById(`itens-${index}`);
      const itensExistentes = Array.from(container.querySelectorAll('.item-nome')).map(input => input.value.trim());
      const valorAtual = input.value.trim();
      const duplicatas = itensExistentes.filter((item, idx) => item === valorAtual && itensExistentes.indexOf(item) !== idx);
      if (duplicatas.length > 0) {
        mostrarMensagemTopo('Este item já foi adicionado.');
        input.value = '';
      }
      // Auto-preenche a unidade de controle a partir do texto do item
      try {
        const itemDiv = input.closest('.item');
        if (itemDiv) {
          const hiddenUnidade = itemDiv.querySelector('.item-unidade');
          const selectedDiv = itemDiv.querySelector('.custom-select .selected');
          const m = (input.value || '').match(/unidade:\s*([A-Za-zÀ-ú]+)/i);
          const unidadeEncontrada = m ? m[1] : '';
          if (hiddenUnidade) hiddenUnidade.value = unidadeEncontrada;
          if (selectedDiv) selectedDiv.textContent = unidadeEncontrada || 'Selecione';
        }
      } catch (e) { /* noop */ }
    
    }

    function removerItem(button) {
      button.closest('.item').remove();
    }

    document.getElementById('enviarPedido').addEventListener('click', function(e) {
      e.preventDefault();
      const solicitante = document.getElementById('solicitante').value.trim();
      const unidade = document.getElementById('unidade').value.trim();
      if (!solicitante || !unidade) {
        mostrarMensagemTopo('Por favor, preencha os campos: Responsável pela solicitação e Unidade de sáude.');
        return;
      }
      const setores = document.querySelectorAll('.setor');
      let todosSetoresValidos = true;
      setores.forEach(setor => {
        const nomeSetor = setor.querySelector('input[name="setor"]').value.trim();
        const itensNomes = setor.querySelectorAll('.item-nome');
        const itensQtds = setor.querySelectorAll('.item-qtd');
        if (!nomeSetor) {
          todosSetoresValidos = false;
          mostrarMensagemTopo('Por favor, selecione um setor.');
          return;
        }
        if (itensNomes.length === 0) {
          todosSetoresValidos = false;
          mostrarMensagemTopo('Por favor, adicione pelo menos um item em cada setor.');
          return;
        }
        itensNomes.forEach((input, index) => {
          const nome = input.value.trim();
          const qtd = itensQtds[index].value.trim();
          if (!nome || !qtd) {
            todosSetoresValidos = false;
            mostrarMensagemTopo('Por favor, preencha todos os campos de item e quantidade.');
            return;
          }
          let validItems;
          if (nomeSetor === 'Farmácia') {
            validItems = farmaciaItems;
          } else if (nomeSetor === 'Psicotrópico') {
            validItems = PsicotópicoItems;
          } else if (nomeSetor === 'Enfermagem') {
            validItems = enfermagemItems;
          } else if (nomeSetor === 'Enfermagem_Urgência_e_Emergência') {
            validItems = Enfermagem_Urgência_e_EmergênciaItems;
          } else if (nomeSetor === 'Enfermagem_Teste_DST') {
            validItems = Enfermagem_Teste_DSTItems;
          } else if (nomeSetor === 'Odonto') {
            validItems = OdontoItems;
          } else if (nomeSetor === 'Odonto_Instrumental') {
            validItems = Odonto_InstrumentalItems;
          } else if (nomeSetor === 'Impressos') {
            validItems = ImpressosItems;
          } else if (nomeSetor === 'Escritório') {
            validItems = EscritórioItems;
          } else if (nomeSetor === 'Consumo_e_Limpeza_Esporádicos') {
            validItems = Consumo_e_Limpeza_EsporádicosItems;
          } else if (nomeSetor === 'Consumo_e_Limpeza_Periódico') {
            validItems = Consumo_e_Limpeza_PeriódicoItems;
          } else if (nomeSetor === 'Epi_Consumo') {
            validItems = Epi_ConsumoItems;
          }
          if (!validItems.includes(nome)) {
            todosSetoresValidos = false;
            mostrarMensagemTopo(`O item "${nome}" não é válido para o setor ${nomeSetor}.`);
            return;
          }
        });
      });
      if (!todosSetoresValidos) {
        return;
      }
      let corpoEmail = `SOLICITAÇÃO DE PEDIDO EXTRA\n\n`;
      corpoEmail += `Responsável pela solicitação: ${solicitante}\n`;
      corpoEmail += `Unidade de saúde: ${unidade}\n\n`;
      corpoEmail += `----------------------------------------\n\n`;
      setores.forEach(setor => {
        const nomeSetor = setor.querySelector('input[name="setor"]').value;
        corpoEmail += `SETOR: ${nomeSetor}\n\n`;
        const itensNomes = setor.querySelectorAll('.item-nome');
        const itensQtds = setor.querySelectorAll('.item-qtd');
        itensNomes.forEach((input, index) => {
          const nome = input.value;
          const qtd = itensQtds[index].value;
          const unidades = setor.querySelectorAll('.item-unidade');
const unidade = (unidades[index] && unidades[index].value) ? unidades[index].value : '';
let m = nome.trim().match(/^((?:\d+\s+){4}\d+)\s+(.*)$/);
let codigo = '';
let descricao = nome;
if (m) { codigo = m[1]; descricao = m[2]; }

descricao = descricao.replace(/\s*unidade:\s*[^,\n]+/gi, '').trim();
corpoEmail += `${codigo ? codigo + ' - ' : ''}${descricao} - ${qtd} ${pluralizarUnidade(unidade, qtd)}
`;
        });
        corpoEmail += `\n`;
        const Justificativa = setor.querySelector('.Justificativa').value;
        if (Justificativa) {
          corpoEmail += `Justificativa: ${Justificativa}\n\n`;
        }
        corpoEmail += `----------------------------------------\n\n`;
      });
      const bodyEncoded = encodeURIComponent(corpoEmail);
const gmailUrl = `https://mail.google.com/mail/?view=cm&fs=1&to=leitaoochefe@gmail.com&su=Pedido Extra - ${encodeURIComponent(unidade)}&body=${bodyEncoded}`;
let win = window.open('about:blank', '_blank');
if (win) {
  win.location.href = gmailUrl;
} else {
  window.location.href = gmailUrl;
}
    });

    window.onload = function() {
      updateDatalist('setor-0', '');
    };
  </script>
<script>
  document.addEventListener('keydown', function(e) {
    if ((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === 's') {
      e.preventDefault();
      mostrarMensagemTopo("Salvar página está desativado.");
    }
  });
</script>
<script>
// Lista de combinações bloqueadas
document.addEventListener('keydown', function(e) {
    // Lista de combinações específicas
    if (
        e.key === 'F12' || // F12
        (e.ctrlKey && e.key.toLowerCase() === 'u') || // Ctrl+U
        (e.ctrlKey && e.key.toLowerCase() === 's') || // Ctrl+S
        (e.ctrlKey && e.shiftKey && e.key.toLowerCase() === 'i') || // Ctrl+Shift+I
        (e.ctrlKey && e.shiftKey && e.key.toLowerCase() === 'j') || // Ctrl+Shift+J
        (e.ctrlKey && e.shiftKey && e.key.toLowerCase() === 'c') || // Ctrl+Shift+C
        (e.ctrlKey && e.shiftKey && e.key.toLowerCase() === 'p') || // Ctrl+Shift+P
        (e.ctrlKey && e.altKey && e.key.toLowerCase() === 'i') // Ctrl+Alt+I
    ) {
        e.preventDefault();
        e.stopPropagation();
        return false;
    }
});

// Bloqueia botão direito
document.addEventListener('contextmenu', function(e) {
    e.preventDefault();
});

// Tentativa de detectar abertura do DevTools (não é 100% garantido)
setInterval(function() {
    if (window.devtoolsOpen) {
        window.location.href = 'about:blank'; // ou redirecionar
    }
    const widthThreshold = window.outerWidth - window.innerWidth > 160;
    const heightThreshold = window.outerHeight - window.innerHeight > 160;
    if (widthThreshold || heightThreshold) {
        window.devtoolsOpen = true;
    }
}, 500);
</script>
<script>
function selectOptionUnidade(unidadeId, value) {
  try {
    const wrapper = document.getElementById(unidadeId);
    if (!wrapper) return;
    const selected = wrapper.querySelector(".selected");
    const hiddenInput = wrapper.querySelector('input.item-unidade, input[name="unidade"]');
    if (selected) selected.textContent = value;
    if (hiddenInput) hiddenInput.value = value;
    const options = wrapper.querySelector(".options");
    if (options) options.style.display = 'none'; // fecha o dropdown
  } catch (e) {
    console.error('selectOptionUnidade error:', e);
  }
}
</script>
<script>
// === VALIDADOR_AUTOMATICO ===
(function() {
  function limparErros(root) {
    (root || document).querySelectorAll('.erro-campo').forEach(el => el.classList.remove('erro-campo'));
    const painel = document.getElementById('mensagensErros');
    if (painel) painel.style.display = 'none';
  }

  function getCampo(refs) {
    for (const sel of refs) {
      const el = document.querySelector(sel);
      if (el) return el;
    }
    return null;
  }

  function validarFormulario() {
    limparErros(document);
    let errosPorSetor = {};

    // Campos principais
    const solicitanteEl = getCampo(['#solicitante','input[name="solicitante" i]']);
    const unidadeSaudeEl = getCampo(['#unidade','input[name="unidade" i]:not(.item-unidade)']);

    if (solicitanteEl && !solicitanteEl.value.trim()) {
      errosPorSetor["Geral"] = errosPorSetor["Geral"] || [];
      errosPorSetor["Geral"].push("Responsável pela solicitação");
      solicitanteEl.classList.add('erro-campo');
    }
    if (unidadeSaudeEl && !unidadeSaudeEl.value.trim()) {
      errosPorSetor["Geral"] = errosPorSetor["Geral"] || [];
      errosPorSetor["Geral"].push("Unidade de saúde");
      unidadeSaudeEl.classList.add('erro-campo');
    }

    // Setores
    const setores = Array.from(document.querySelectorAll('.setor'));
    setores.forEach((setor, sIndex) => {
      const setorInput = setor.querySelector('input[name="setor"]');
      const setorNomeSelecionado = (setorInput && setorInput.value.trim()) ? setorInput.value.trim() : "Setor não selecionado";

      if (!errosPorSetor[setorNomeSelecionado]) {
        errosPorSetor[setorNomeSelecionado] = [];
      }

      if (!setorInput || !setorInput.value.trim()) {
        errosPorSetor[setorNomeSelecionado].push("Setor não selecionado");
        if (setorInput) setorInput.classList.add('erro-campo');
      }

      const itens = Array.from(setor.querySelectorAll('.item'));
      if (itens.length === 0) {
        errosPorSetor[setorNomeSelecionado].push("Nenhum item adicionado");
      }

      itens.forEach((item, iIndex) => {
        const nomeItem = item.querySelector('.item-nome');
        const qtdItem = item.querySelector('.item-qtd');
        const unidadeItem = item.querySelector('.item-unidade');

        if (nomeItem && !nomeItem.value.trim()) {
          errosPorSetor[setorNomeSelecionado].push(`Nome do item ${iIndex + 1} não preenchido`);
          nomeItem.classList.add('erro-campo');
        }
        if (qtdItem && (!qtdItem.value || Number(qtdItem.value) <= 0)) {
          errosPorSetor[setorNomeSelecionado].push(`Quantidade do item ${iIndex + 1} inválida`);
          qtdItem.classList.add('erro-campo');
        }
        if (unidadeItem && !unidadeItem.value.trim()) {
          errosPorSetor[setorNomeSelecionado].push(`
          unidadeItem.classList.add('erro-campo');
        }
      });
    });
    // Remover setores sem erros para evitar listar "Setor" sem itens de erro
    for (const key of Object.keys(errosPorSetor)) {
      if (!Array.isArray(errosPorSetor[key]) || errosPorSetor[key].length === 0) {
        delete errosPorSetor[key];
      }
    }



    if (Object.keys(errosPorSetor).length) {
      let msgHTML = "<h3>⚠️ Preencha os seguintes campos obrigatórios:</h3>";
      for (const setor in errosPorSetor) {
        msgHTML += `<strong>${setor}</strong><ul>`;
        errosPorSetor[setor].forEach(err => {
          msgHTML += `<li>${err}</li>`;
        });
        msgHTML += "</ul>";
      }
      const painel = document.getElementById('mensagensErros');
      if (painel) {
        painel.innerHTML = msgHTML;
        painel.style.display = 'block';
        painel.scrollIntoView({ behavior: 'smooth', block: 'start' });
      }
      const primeiroErro = document.querySelector('.erro-campo');
      if (primeiroErro) {
        try { primeiroErro.focus(); } catch (_e) {}
      }
      return false;
    }
    return true;
  }

  function armarListeners() {
    const form = document.getElementById('pedidoForm') || document.querySelector('form');
    const enviarBtn = document.getElementById('enviarPedido') || document.querySelector('button[id*="enviar" i]') || document.querySelector('button[type="submit"]');

    if (form) {
      form.addEventListener('submit', function(e) {
        if (!validarFormulario()) {
          e.preventDefault();
          e.stopPropagation();
          e.stopImmediatePropagation();
        }
      }, true);
    }

    if (enviarBtn) {
      enviarBtn.addEventListener('click', function(e) {
        if (!validarFormulario()) {
          e.preventDefault();
          e.stopPropagation();
          e.stopImmediatePropagation();
        }
      }, true);
    }
  }

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', armarListeners);
  } else {
    armarListeners();
  }
})();
</script>
<script>
function isSetorValido(selectElement) {
  if (!selectElement) return false;
  const value = (selectElement.value || "").trim();
  return value !== "" && value !== "Selecione";
}
</script>
<script>
document.addEventListener("input", function(e) {
  if (e.target.classList.contains("erro-campo")) {
    e.target.classList.remove("erro-campo");
    e.target.style.backgroundColor = "";
    e.target.style.outline = "";
  }
});
document.addEventListener("change", function(e) {
  if (e.target.classList.contains("erro-campo")) {
    e.target.classList.remove("erro-campo");
    e.target.style.backgroundColor = "";
    e.target.style.outline = "";
  }
});
</script>

<script>
(function() {
  var container = document.getElementById('setoresContainer');
  var enviar = document.getElementById('enviarPedido');
  if (!container || !enviar) return;

  function toggleEnviar() {
    try {
      enviar.style.display = (container.children && container.children.length > 0) ? 'inline-block' : 'none';
    } catch(e) {}
  }

  // Verificação inicial (caso a página carregue sem setores)
  toggleEnviar();

  // Observa adições/remoções diretas de setores
  var observer = new MutationObserver(function() {
    toggleEnviar();
  });
  observer.observe(container, { childList: true });

  // (Opcional) expõe função global segura para uso em outros pontos do código
  window.__toggleEnviarPedido__ = toggleEnviar;
})();
</script>

<!-- Firebase integração -->



<script>
document.addEventListener("DOMContentLoaded", function() {
  const btnEnviar = document.getElementById("enviarPedido");
  if (btnEnviar) {
    btnEnviar.addEventListener("click", function(e) {
      e.preventDefault();
      if (btnEnviar.disabled) return;
      btnEnviar.disabled = true;

      // Chama a função original de envio, se existir
      if (typeof enviarPedido === "function") {
        enviarPedido();
      }

      // Reativa depois de alguns segundos para permitir novo envio
      setTimeout(() => { btnEnviar.disabled = false; }, 5000);
    }, { once: false });
  }
});
</script>


<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
  import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCdB4pI610z1rplKmfAHct7CmGD0vmBg3U",
    authDomain: "almoxarifadobotucatu-5e03d.firebaseapp.com",
    projectId: "almoxarifadobotucatu-5e03d",
    storageBucket: "almoxarifadobotucatu-5e03d.firebasestorage.app",
    messagingSenderId: "828951000388",
    appId: "1:828951000388:web:06dbe3cb5764872e7b1311"
  };

  // Inicializa Firebase e Firestore
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  async function enviarPedido() {
    const solicitante = document.getElementById("solicitante").value.trim();
    const unidade = document.getElementById("unidade").value.trim();
    const itens = [];

    document.querySelectorAll(".item").forEach(itemDiv => {
      const nome = itemDiv.querySelector(".item-nome")?.value;
      const quantidade = itemDiv.querySelector(".item-qtd")?.value;
      const unidadeControle = itemDiv.querySelector(".item-unidade")?.value;
      );
      }
    });

    if (!solicitante || !unidade || itens.length === 0) {
      mostrarMensagemTopo("⚠️ Preencha todos os campos e adicione pelo menos um item.");
      return;
    }

    const dados = {
      solicitante,
      unidade,
      itens,
      data: new Date().toISOString()
    };

    try {
      await addDoc(collection(db, "pedidos"), dados);
      mostrarMensagemTopo("<h3>✅ Pedido enviado com sucesso!</h3>", "success");
      document.getElementById("pedidoForm").reset();
      document.getElementById("setoresContainer").innerHTML = "";
    } catch (erro) {
      console.error("Erro ao salvar no Firebase:", erro);
      mostrarMensagemTopo("❌ Erro ao enviar o pedido. Tente novamente.");
    }
  }

  // Listener único para o botão
  const btn = document.getElementById("enviarPedido");
  if (btn) {
    btn.addEventListener("click", async (e) => {
      e.preventDefault();
      if (btn.disabled) return;
      btn.disabled = true;
      await enviarPedido();
      setTimeout(() => { btn.disabled = false; }, 2000);
    });
  }
</script>


<script>
function atualizarUnidade() {
  const select = document.getElementById("medicamento");
  const valor = select.value;
  if (!valor) return;
  const match = valor.match(/unidade:\s*([^"]+)/i);
  if (match) {
    document.getElementById("unidadeControle").value = match[1].trim();
  }
}
</script>


<script>
function atualizarUnidade(selectElement) {
  const valor = selectElement.value;
  if (!valor) return;
  const match = valor.match(/unidade:\\s*([^"]+)/i);
  if (match) {
    const unidadeInput = selectElement.closest(".item-row").querySelector(".unidadeControle");
    if (unidadeInput) {
      unidadeInput.value = match[1].trim();
    }
  }
}
</script>


<script>
function atualizarUnidade(selectElement) {
  const valor = selectElement.value;
  if (!valor) return;

  const match = valor.match(/unidade:\s*([^"]+)/i);
  if (match) {
    const unidadeInput = selectElement.closest(".item-row").querySelector(".unidadeControle");
    if (unidadeInput) {
      unidadeInput.value = match[1].trim();
    }
  }
}
</script>


<script>
document.addEventListener("input", function(e) {
  if (e.target && e.target.classList.contains("item-nome")) {
    const itemDiv = e.target.closest(".item");
    if (itemDiv) {
      const unidadeControleInput = itemDiv.querySelector(".unidade-controle");
      preencherUnidadeControle(e.target.value, unidadeControleInput);
    }
  }
});
</script>





<script>
// --- Ocultar "unidade:" na lista, restaurar valor original e preencher Unidade de Controle ---
(function() {
  function handleInput(e) {
    if (!e.target.classList || !e.target.classList.contains('item-nome')) return;
    var listId = e.target.getAttribute('list');
    var dl = listId ? document.getElementById(listId) : null;
    if (!dl) return;
    var match = Array.from(dl.options).find(function(o){ 
      return o.value === e.target.value && o.dataset && o.dataset.original; 
    });
    if (match) {
      // Valor original (com unidade:)
      var original = match.dataset.original;
      e.target.value = original;

      // Preenche automaticamente a "Unidade de Controle"
      var m = original.match(/unidade:\s*([^,\n]+)/i);
      if (m) {
        // tenta encontrar pelo id ou classe
        var unidadeCtrl = document.getElementById('unidade-controle') || document.querySelector('.unidade-controle'); 
        if (unidadeCtrl) unidadeCtrl.value = m[1].trim();
      }

      // dispara change para manter as lógicas já existentes
      var evt = new Event('change', { bubbles: true });
      e.target.dispatchEvent(evt);
    }
  }
  document.addEventListener('input', handleInput, true);
})();
</script>


<script>
document.addEventListener("DOMContentLoaded", function() {
  const form = document.getElementById("pedidoForm");
  const btnEnviar = document.getElementById("enviarPedido");

</script>
<script>
// === VALIDADOR_AUTOMATICO ===
(function() {
  function limparErros(root) {
    (root || document).querySelectorAll('.erro-campo').forEach(el => el.classList.remove('erro-campo'));
    const painel = document.getElementById('mensagensErros');
    if (painel) painel.style.display = 'none';
  }

  function getCampo(refs) {
    for (const sel of refs) {
      const el = document.querySelector(sel);
      if (el) return el;
    }
    return null;
  }

  function validarFormulario() {
    limparErros(document);
    let errosPorSetor = {};

    // Campos principais
    const solicitanteEl = getCampo(['#solicitante','input[name="solicitante" i]']);
    const unidadeSaudeEl = getCampo(['#unidade','input[name="unidade" i]:not(.item-unidade)']);

    if (solicitanteEl && !solicitanteEl.value.trim()) {
      errosPorSetor["Geral"] = errosPorSetor["Geral"] || [];
      errosPorSetor["Geral"].push("Responsável pela solicitação");
      solicitanteEl.classList.add('erro-campo');
    }
    if (unidadeSaudeEl && !unidadeSaudeEl.value.trim()) {
      errosPorSetor["Geral"] = errosPorSetor["Geral"] || [];
      errosPorSetor["Geral"].push("Unidade de saúde");
      unidadeSaudeEl.classList.add('erro-campo');
    }

    // Setores
    const setores = Array.from(document.querySelectorAll('.setor'));
    setores.forEach((setor, sIndex) => {
      const setorInput = setor.querySelector('input[name="setor"]');
      const setorNomeSelecionado = (setorInput && setorInput.value.trim()) ? setorInput.value.trim() : "Setor não selecionado";

      if (!errosPorSetor[setorNomeSelecionado]) {
        errosPorSetor[setorNomeSelecionado] = [];
      }

      if (!setorInput || !setorInput.value.trim()) {
        errosPorSetor[setorNomeSelecionado].push("Setor não selecionado");
        if (setorInput) setorInput.classList.add('erro-campo');
      }

      const itens = Array.from(setor.querySelectorAll('.item'));
      if (itens.length === 0) {
        errosPorSetor[setorNomeSelecionado].push("Nenhum item adicionado");
      }

      itens.forEach((item, iIndex) => {
        const nomeItem = item.querySelector('.item-nome');
        const qtdItem = item.querySelector('.item-qtd');
        const unidadeItem = item.querySelector('.item-unidade');

        if (nomeItem && !nomeItem.value.trim()) {
          errosPorSetor[setorNomeSelecionado].push(`Nome do item ${iIndex + 1} não preenchido`);
          nomeItem.classList.add('erro-campo');
        }
        if (qtdItem && (!qtdItem.value || Number(qtdItem.value) <= 0)) {
          errosPorSetor[setorNomeSelecionado].push(`Quantidade do item ${iIndex + 1} inválida`);
          qtdItem.classList.add('erro-campo');
        }
        if (unidadeItem && !unidadeItem.value.trim()) {
          errosPorSetor[setorNomeSelecionado].push(`Unidade de controle do item ${iIndex + 1} não preenchida`);
          unidadeItem.classList.add('erro-campo');
        }
      });
    });
    // Remover setores sem erros para evitar listar "Setor" sem itens de erro
    for (const key of Object.keys(errosPorSetor)) {
      if (!Array.isArray(errosPorSetor[key]) || errosPorSetor[key].length === 0) {
        delete errosPorSetor[key];
      }
    }



    if (Object.keys(errosPorSetor).length) {
      let msgHTML = "<h3>⚠️ Preencha os seguintes campos obrigatórios:</h3>";
      for (const setor in errosPorSetor) {
        msgHTML += `<strong>${setor}</strong><ul>`;
        errosPorSetor[setor].forEach(err => {
          msgHTML += `<li>${err}</li>`;
        });
        msgHTML += "</ul>";
      }
      const painel = document.getElementById('mensagensErros');
      if (painel) {
        painel.innerHTML = msgHTML;
        painel.style.display = 'block';
        painel.scrollIntoView({ behavior: 'smooth', block: 'start' });
      }
      const primeiroErro = document.querySelector('.erro-campo');
      if (primeiroErro) {
        try { primeiroErro.focus(); } catch (_e) {}
      }
      return false;
    }
    return true;
  }

  function armarListeners() {
    const form = document.getElementById('pedidoForm') || document.querySelector('form');
    const enviarBtn = document.getElementById('enviarPedido') || document.querySelector('button[id*="enviar" i]') || document.querySelector('button[type="submit"]');

    if (form) {
      form.addEventListener('submit', function(e) {
        if (!validarFormulario()) {
          e.preventDefault();
          e.stopPropagation();
          e.stopImmediatePropagation();
        }
      }, true);
    }

    if (enviarBtn) {
      enviarBtn.addEventListener('click', function(e) {
        if (!validarFormulario()) {
          e.preventDefault();
          e.stopPropagation();
          e.stopImmediatePropagation();
        }
      }, true);
    }
  }

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', armarListeners);
  } else {
    armarListeners();
  }
})();
</script>
<script>
function isSetorValido(selectElement) {
  if (!selectElement) return false;
  const value = (selectElement.value || "").trim();
  return value !== "" && value !== "Selecione";
}
</script>
<script>
document.addEventListener("input", function(e) {
  if (e.target.classList.contains("erro-campo")) {
    e.target.classList.remove("erro-campo");
    e.target.style.backgroundColor = "";
    e.target.style.outline = "";
  }
});
document.addEventListener("change", function(e) {
  if (e.target.classList.contains("erro-campo")) {
    e.target.classList.remove("erro-campo");
    e.target.style.backgroundColor = "";
    e.target.style.outline = "";
  }
});
</script>

<script>
(function() {
  var container = document.getElementById('setoresContainer');
  var enviar = document.getElementById('enviarPedido');
  if (!container || !enviar) return;

  function toggleEnviar() {
    try {
      enviar.style.display = (container.children && container.children.length > 0) ? 'inline-block' : 'none';
    } catch(e) {}
  }

  // Verificação inicial (caso a página carregue sem setores)
  toggleEnviar();

  // Observa adições/remoções diretas de setores
  var observer = new MutationObserver(function() {
    toggleEnviar();
  });
  observer.observe(container, { childList: true });

  // (Opcional) expõe função global segura para uso em outros pontos do código
  window.__toggleEnviarPedido__ = toggleEnviar;
})();
</script>

<!-- Firebase integração -->



<script>
document.addEventListener("DOMContentLoaded", function() {
  const btnEnviar = document.getElementById("enviarPedido");
  if (btnEnviar) {
    btnEnviar.addEventListener("click", function(e) {
      e.preventDefault();
      if (btnEnviar.disabled) return;
      btnEnviar.disabled = true;

      // Chama a função original de envio, se existir
      if (typeof enviarPedido === "function") {
        enviarPedido();
      }

      // Reativa depois de alguns segundos para permitir novo envio
      setTimeout(() => { btnEnviar.disabled = false; }, 5000);
    }, { once: false });
  }
});
</script>


<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
  import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCdB4pI610z1rplKmfAHct7CmGD0vmBg3U",
    authDomain: "almoxarifadobotucatu-5e03d.firebaseapp.com",
    projectId: "almoxarifadobotucatu-5e03d",
    storageBucket: "almoxarifadobotucatu-5e03d.firebasestorage.app",
    messagingSenderId: "828951000388",
    appId: "1:828951000388:web:06dbe3cb5764872e7b1311"
  };

  // Inicializa Firebase e Firestore
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  async function enviarPedido() {
    const solicitante = document.getElementById("solicitante").value.trim();
    const unidade = document.getElementById("unidade").value.trim();
    const itens = [];

    document.querySelectorAll(".item").forEach(itemDiv => {
      const nome = itemDiv.querySelector(".item-nome")?.value;
      const quantidade = itemDiv.querySelector(".item-qtd")?.value;
      const unidadeControle = itemDiv.querySelector(".item-unidade")?.value;
      // Captura o setor a partir do container .setor mais próximo
      const setorContainer = itemDiv.closest(".setor");
      const setor = setorContainer ? (setorContainer.querySelector('input[name="setor"]')?.value || "") : "";
      if (nome && quantidade && unidadeControle) {
        itens.push({ nome, quantidade, unidadeControle, setor });
      }
    });

    if (!solicitante || !unidade || itens.length === 0) {
      alert("⚠️ Preencha todos os campos e adicione pelo menos um item.");
      return;
    }

    const dados = {
      solicitante,
      unidade,
      itens,
      data: new Date().toISOString()
    };

    try {
      await addDoc(collection(db, "pedidos"), dados);
      alert("✅ Pedido enviado com sucesso!");
      document.getElementById("pedidoForm").reset();
      document.getElementById("setoresContainer").innerHTML = "";
    } catch (erro) {
      console.error("Erro ao salvar no Firebase:", erro);
      alert("❌ Erro ao enviar o pedido. Tente novamente.");
    }
  }

  // Listener único para o botão
  const btn = document.getElementById("enviarPedido");
  if (btn) {
    btn.addEventListener("click", async (e) => {
      e.preventDefault();
      if (btn.disabled) return;
      btn.disabled = true;
      await enviarPedido();
      setTimeout(() => { btn.disabled = false; }, 2000);
    });
  }
</script>

</body>
</html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<title>Rodapé Profissional Pequeno</title>
<style>
    footer {
      position: fixed;
      bottom: 8px;
      right: 12px;
      font-size: 9px;            /* fonte menor */
      color: #888888;
      background-color: transparent;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      opacity: 0.75;
      user-select: none;
      text-shadow: 0 0 1px rgba(0,0,0,0.1);
      letter-spacing: 0.02em;
    }
  
/* === Override: alinhamento de Item / Quantidade / Unidade === */
.item {
  display: flex;
  flex-wrap: nowrap;
  gap: 12px;
  align-items: flex-end;
}
.item .item-input-group.item-nome-group { flex: 1 1 50%; min-width: 220px; }
.item .item-input-group.item-qtd-group { flex: 0 0 100px; }
.item .item-input-group.item-unidade-group { flex: 0 0 160px; }
.item .item-input-group.item-unidade-group select,
.item .item-input-group input {
  width: 100%;
  padding: 10px 14px;
  border: 1px solid var(--border-light);
  border-radius: 12px;
  box-sizing: border-box;
  font-size: 0.95rem;
  background-color: rgba(255,255,255,0.08);
  color: var(--text-dark);
}
.item .item-input-group.item-unidade-group select:focus,
.item .item-input-group input:focus {
  outline: none;
  border-color: var(--primary-color);
  box-shadow: 0 0 0 3px rgba(10,102,194,0.25);
}
/* Responsivo: empilha no mobile */
@media (max-width: 640px) {
  .item { flex-wrap: wrap; }
  .item .item-input-group.item-nome-group,
  .item .item-input-group.item-qtd-group,
  .item .item-input-group.item-unidade-group { flex: 1 1 100%; }
}

/* Unidade de Controle com mesmo estilo do campo Setor */
.item .item-input-group.item-unidade-group select {
  width: 100%;
  padding: 14px 18px;
  border: 1px solid var(--border-light);
  border-radius: 12px;
  box-sizing: border-box;
  font-size: 1rem;
  color: var(--text-dark);
  background-color: rgba(255, 255, 255, 0.1);
  transition: var(--transition-all);
}
.item .item-input-group.item-unidade-group select:focus {
  outline: none;
  border-color: var(--primary-color);
  box-shadow: 0 0 0 4px rgba(10, 102, 194, 0.3);
  background-color: rgba(255, 255, 255, 0.15);
}


/* Unidade de Controle reutiliza o mesmo visual do Setor */
.item .item-input-group.item-unidade-group .custom-select {
  width: 100%;
}

/* === Correção mínima: altura da Unidade de Controle igual aos outros campos === */
.item .item-input-group.item-unidade-group .custom-select .selected {
  height: 48px;       /* mesma altura do input */
  line-height: 48px;  /* centraliza verticalmente */
}

/* === Ajuste final: Unidade de Controle com a mesma altura da Quantidade === */
.item .item-input-group.item-unidade-group .custom-select .selected {
  height: 40px;       /* mesma altura da Quantidade */
  line-height: 40px;  /* centraliza verticalmente */
}
</style>
<style>
  #enviarPedido {
    display: none;
  }
</style>
</meta></head>
  
<body>
<script src="/protege-pagina.js"></script>
<footer>
    © 2025.Todos os direitos reservados.
  </footer>
<!-- Firebase integração -->



<script>
document.addEventListener("DOMContentLoaded", function() {
  const btnEnviar = document.getElementById("enviarPedido");
  if (btnEnviar) {
    btnEnviar.addEventListener("click", function(e) {
      e.preventDefault();
      if (btnEnviar.disabled) return;
      btnEnviar.disabled = true;

      // Chama a função original de envio, se existir
      if (typeof enviarPedido === "function") {
        enviarPedido();
      }

      // Reativa depois de alguns segundos para permitir novo envio
      setTimeout(() => { btnEnviar.disabled = false; }, 5000);
    }, { once: false });
  }
});
</script>


<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
  import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCdB4pI610z1rplKmfAHct7CmGD0vmBg3U",
    authDomain: "almoxarifadobotucatu-5e03d.firebaseapp.com",
    projectId: "almoxarifadobotucatu-5e03d",
    storageBucket: "almoxarifadobotucatu-5e03d.firebasestorage.app",
    messagingSenderId: "828951000388",
    appId: "1:828951000388:web:06dbe3cb5764872e7b1311"
  };

  // Inicializa Firebase e Firestore
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  async function enviarPedido() {
    const solicitante = document.getElementById("solicitante").value.trim();
    const unidade = document.getElementById("unidade").value.trim();
    const itens = [];

    document.querySelectorAll(".item").forEach(itemDiv => {
      const nome = itemDiv.querySelector(".item-nome")?.value;
      const quantidade = itemDiv.querySelector(".item-qtd")?.value;
      const unidadeControle = itemDiv.querySelector(".item-unidade")?.value;
      if (nome && quantidade && unidadeControle) {
        itens.push({ nome, quantidade, unidadeControle });
      }
    });

    if (!solicitante || !unidade || itens.length === 0) {
      alert("⚠️ Preencha todos os campos e adicione pelo menos um item.");
      return;
    }

    const dados = {
      solicitante,
      unidade,
      itens,
      data: new Date().toISOString()
    };

    try {
      await addDoc(collection(db, "pedidos"), dados);
      alert("✅ Pedido enviado com sucesso!");
      document.getElementById("pedidoForm").reset();
      document.getElementById("setoresContainer").innerHTML = "";
    } catch (erro) {
      console.error("Erro ao salvar no Firebase:", erro);
      alert("❌ Erro ao enviar o pedido. Tente novamente.");
    }
  }

  // Listener único para o botão
  const btn = document.getElementById("enviarPedido");
  if (btn) {
    btn.addEventListener("click", async (e) => {
      e.preventDefault();
      if (btn.disabled) return;
      btn.disabled = true;
      await enviarPedido();
      setTimeout(() => { btn.disabled = false; }, 2000);
    });
  }
</script>

</body></html></head></html>
