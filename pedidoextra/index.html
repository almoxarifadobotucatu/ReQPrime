<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Solicitação de Pedido Extra</title>
</head>
<body>
  <h2>Solicitação de Pedido Extra</h2>
  <form id="pedidoForm">
    <label for="solicitante">Responsável pela solicitação:</label>
    <input autocomplete="off" id="solicitante" required type="text"/>
    <label for="unidade">Unidade de saúde:</label>
    <input autocomplete="off" id="unidade" required type="text" list="lista-unidades"/>
    <datalist id="lista-unidades">
      <option value="USF CAIMA"></option>
      <option value="USF COHAB IV"></option>
    </datalist>

    <div id="setoresContainer">
      <!-- exemplo de item --> 
      <input class="item-nome-input" list="lista-itens" placeholder="Escolha o item"/>
    </div>

    <div class="buttons">
      <button id="enviarPedido" type="button">Enviar pedido</button>
    </div>
  </form>

  <datalist id="lista-itens">
    <option value="Aciclovir 200mg" data-item-completo="1 01 06 0001 7 Aciclovir 200mg unidade: Comprimido"></option>
    <option value="Ácido Acético 15%" data-item-completo="1 01 20 0417 9 Ácido Acético 15% - Frasco 50 ML unidade: Frasco"></option>
  </datalist>

<script>
// === Função para capturar itens selecionados com código original ===
function coletarItensComCodigo() {
  const itensSelecionados = [];
  document.querySelectorAll("#setoresContainer .item-nome-input").forEach(input => {
    const valorExibido = input.value;
    const option = [...document.querySelectorAll("#lista-itens option")]
                     .find(opt => opt.value === valorExibido);

    // pega o item completo (com código) se existir, senão usa o valor digitado
    const itemCompleto = option ? option.dataset.itemCompleto : valorExibido;

    itensSelecionados.push(itemCompleto);
  });
  return itensSelecionados;
}

// === Exemplo de uso no envio do formulário ===
function enviarPedidoPorEmail() {
  const solicitante = document.getElementById("solicitante").value;
  const unidade = document.getElementById("unidade").value;
  const itens = coletarItensComCodigo();

  const corpoEmail = `
    Responsável: ${solicitante}\n
    Unidade de saúde: ${unidade}\n
    Itens:\n${itens.join("\n")}
  `;

  // aqui você coloca sua lógica de envio (ex: EmailJS, backend, etc.)
  console.log("Enviando email:", corpoEmail);
}

// substitui o botão enviar para chamar essa função
const btnEnviar = document.getElementById("enviarPedido");
if (btnEnviar) {
  btnEnviar.addEventListener("click", enviarPedidoPorEmail);
}
</script>
</body>
</html>
