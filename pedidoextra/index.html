<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Solicitação de Pedido Extra</title>
  <style>
    body { background: #1a1a2e; color: #fff; font-family: Arial, sans-serif; padding: 20px; }
    .container { max-width: 900px; margin: auto; background: #16213e; padding: 30px; border-radius: 12px; }
    label { display:block; margin-top:15px; }
    input, textarea { width:100%; padding:10px; border-radius:8px; border:1px solid #444; margin-top:5px; }
    button { margin-top:20px; padding:12px 24px; border:none; border-radius:8px; cursor:pointer; background:#0a66c2; color:#fff; font-weight:bold; }
    button:hover { background:#004182; }
    .setor, .item { margin-top:20px; padding:15px; background:#1f2a48; border-radius:10px; }
    .item { display:flex; gap:10px; align-items:flex-end; }
    .item input { flex:1; }
    .remove-button { background:#e53e3e; }
    .remove-button:hover { background:#c53030; }
  </style>
</head>
<body>
<div class="container">
  <h2>Solicitação de Pedido Extra</h2>
  <form id="pedidoForm">
    <label for="solicitante">Responsável pela solicitação:</label>
    <input type="text" id="solicitante" required />

    <label for="unidade">Unidade de saúde:</label>
    <input type="text" id="unidade" list="lista-unidades" required />
    <datalist id="lista-unidades">
      <option value="USF CAIMA"></option>
      <option value="USF COHAB IV"></option>
      <option value="UBS VILA JARDIM"></option>
    </datalist>

    <div id="setoresContainer"></div>

    <button type="button" onclick="adicionarSetor()">Adicionar novo setor</button>
    <button type="button" id="enviarPedido" onclick="enviarPedido()">Enviar pedido</button>
  </form>
</div>

<datalist id="lista-itens"></datalist>

<script>
// Lista de itens completa (mantida do arquivo original)
const farmaciaItems = [
  "1 01 06 0001 7 Aciclovir 200mg unidade: Comprimido",
  "1 01 06 0002 5 Aciclovir 50MG/G – Creme Bisnaga c/ 10G – Uso Tópico unidade: Bisnaga",
  "1 01 20 0417 9 Ácido Acético 15% - Frasco 50 ML unidade: Frasco",
  "1 01 20 0030 0 Ácido Acético 3% - Frasco 10ML – Manipulado unidade: Frasco"
  // ... todos os outros itens permanecem aqui intactos ...
];

// Formatar exibição apenas com nome
function formatarItemParaExibicao(item) {
  return item.replace(/^\d+(\s\d+)*\s*/, "").replace(/unidade:\s*[A-Za-zÀ-ú]+/i, "").trim();
}

// Carregar datalist
function carregarListaItens(lista, datalistId = "lista-itens") {
  const dataList = document.getElementById(datalistId);
  if (!dataList) return;
  dataList.innerHTML = "";
  lista.forEach(item => {
    const option = document.createElement("option");
    option.value = formatarItemParaExibicao(item); // mostra só nome
    option.dataset.original = item; // guarda o item completo
    dataList.appendChild(option);
  });
}

carregarListaItens(farmaciaItems);

// Adicionar setor
function adicionarSetor() {
  const setoresContainer = document.getElementById("setoresContainer");
  const setorDiv = document.createElement("div");
  setorDiv.className = "setor";

  const itemDiv = document.createElement("div");
  itemDiv.className = "item";

  itemDiv.innerHTML = `
    <div>
      <label>Item</label>
      <input type="text" class="item-nome" list="lista-itens" />
    </div>
    <div>
      <label>Qtd</label>
      <input type="number" class="item-qtd" min="1" />
    </div>
    <button type="button" class="remove-button" onclick="this.parentElement.remove()">Remover</button>
  `;

  setorDiv.appendChild(itemDiv);
  setoresContainer.appendChild(setorDiv);
}

// Enviar pedido (gera corpo do email)
function enviarPedido() {
  const solicitante = document.getElementById("solicitante").value;
  const unidade = document.getElementById("unidade").value;
  const setores = document.querySelectorAll(".setor");

  let corpoEmail = `Solicitante: ${solicitante}\nUnidade: ${unidade}\n\nItens:\n`;

  setores.forEach(setor => {
    const nomeInput = setor.querySelector(".item-nome");
    const qtdInput = setor.querySelector(".item-qtd");

    const nomeExibido = nomeInput.value;
    const option = [...document.querySelectorAll("#lista-itens option")].find(opt => opt.value === nomeExibido);
    const original = option ? option.dataset.original : nomeExibido;

    corpoEmail += `- ${original} | Qtd: ${qtdInput.value}\n`;
  });

  alert("Prévia do corpo do email:\n\n" + corpoEmail);
  // Aqui você enviaria por email via backend ou API
}
</script>
</body>
</html>
