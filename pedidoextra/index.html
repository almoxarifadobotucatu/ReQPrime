<!DOCTYPE html>

<html lang="pt-BR">
<head>
  <script>
    // Redireciona imediatamente se tentar acessar direto
    if (document.referrer === "" || document.referrer === window.location.href) {
      window.location.replace("https://almoxarifadobotucatu.netlify.app/");
    }
  </script>

<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>

  <link rel="icon" type="image/png" href="data:image/png;base64,...#v2">

<title>Solicitação de Pedido Extra</title>
  <link rel="icon" type="image/png" sizes="32x32" href="data:image/png;base64,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">

<script>
  document.addEventListener('keydown', function(e) {
    if ((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === 's') {
      e.preventDefault();
      alert("Salvar página está desativado.");
    }
  });
</script>
<script>
// Lista de combinações bloqueadas
document.addEventListener('keydown', function(e) {
    // Lista de combinações específicas
    if (
        e.key === 'F12' || // F12
        (e.ctrlKey && e.key.toLowerCase() === 'u') || // Ctrl+U
        (e.ctrlKey && e.key.toLowerCase() === 's') || // Ctrl+S
        (e.ctrlKey && e.shiftKey && e.key.toLowerCase() === 'i') || // Ctrl+Shift+I
        (e.ctrlKey && e.shiftKey && e.key.toLowerCase() === 'j') || // Ctrl+Shift+J
        (e.ctrlKey && e.shiftKey && e.key.toLowerCase() === 'c') || // Ctrl+Shift+C
        (e.ctrlKey && e.shiftKey && e.key.toLowerCase() === 'p') || // Ctrl+Shift+P
        (e.ctrlKey && e.altKey && e.key.toLowerCase() === 'i') // Ctrl+Alt+I
    ) {
        e.preventDefault();
        e.stopPropagation();
        return false;
    }
});

// Bloqueia botão direito
document.addEventListener('contextmenu', function(e) {
    e.preventDefault();
});

// Tentativa de detectar abertura do DevTools (não é 100% garantido)
setInterval(function() {
    if (window.devtoolsOpen) {
        window.location.href = 'about:blank'; // ou redirecionar
    }
    const widthThreshold = window.outerWidth - window.innerWidth > 160;
    const heightThreshold = window.outerHeight - window.innerHeight > 160;
    if (widthThreshold || heightThreshold) {
        window.devtoolsOpen = true;
    }
}, 500);
</script>
<script>
function selectOptionUnidade(unidadeId, value) {
  try {
    const wrapper = document.getElementById(unidadeId);
    if (!wrapper) return;
    const selected = wrapper.querySelector(".selected");
    const hiddenInput = wrapper.querySelector('input.item-unidade, input[name="unidade"]');
    if (selected) selected.textContent = value;
    if (hiddenInput) hiddenInput.value = value;
    const options = wrapper.querySelector(".options");
    if (options) options.style.display = 'none'; // fecha o dropdown
  } catch (e) {
    console.error('selectOptionUnidade error:', e);
  }
}
</script>
<script>
// === VALIDADOR_AUTOMATICO ===
(function() {
  function limparErros(root) {
    (root || document).querySelectorAll('.erro-campo').forEach(el => el.classList.remove('erro-campo'));
    const painel = document.getElementById('mensagensErros');
    if (painel) painel.style.display = 'none';
  }

  function getCampo(refs) {
    for (const sel of refs) {
      const el = document.querySelector(sel);
      if (el) return el;
    }
    return null;
  }

  function validarFormulario() {
    limparErros(document);
    let errosPorSetor = {};

    // Campos principais
    const solicitanteEl = getCampo(['#solicitante','input[name="solicitante" i]']);
    const unidadeSaudeEl = getCampo(['#unidade','input[name="unidade" i]:not(.item-unidade)']);

    if (solicitanteEl && !solicitanteEl.value.trim()) {
      errosPorSetor["Geral"] = errosPorSetor["Geral"] || [];
      errosPorSetor["Geral"].push("Responsável pela solicitação");
      solicitanteEl.classList.add('erro-campo');
    }
    if (unidadeSaudeEl && !unidadeSaudeEl.value.trim()) {
      errosPorSetor["Geral"] = errosPorSetor["Geral"] || [];
      errosPorSetor["Geral"].push("Unidade de saúde");
      unidadeSaudeEl.classList.add('erro-campo');
    }

    // Setores
    const setores = Array.from(document.querySelectorAll('.setor'));
    setores.forEach((setor, sIndex) => {
      const setorInput = setor.querySelector('input[name="setor"]');
      const setorNomeSelecionado = (setorInput && setorInput.value.trim()) ? setorInput.value.trim() : "Setor não selecionado";

      if (!errosPorSetor[setorNomeSelecionado]) {
        errosPorSetor[setorNomeSelecionado] = [];
      }

      if (!setorInput || !setorInput.value.trim()) {
        errosPorSetor[setorNomeSelecionado].push("Setor não selecionado");
        if (setorInput) setorInput.classList.add('erro-campo');
      }

      const itens = Array.from(setor.querySelectorAll('.item'));
      if (itens.length === 0) {
        errosPorSetor[setorNomeSelecionado].push("Nenhum item adicionado");
      }

      itens.forEach((item, iIndex) => {
        const nomeItem = item.querySelector('.item-nome');
        const qtdItem = item.querySelector('.item-qtd');
        const unidadeItem = item.querySelector('.item-unidade');

        if (nomeItem && !nomeItem.value.trim()) {
          errosPorSetor[setorNomeSelecionado].push(`Nome do item ${iIndex + 1} não preenchido`);
          nomeItem.classList.add('erro-campo');
        }
        if (qtdItem && (!qtdItem.value || Number(qtdItem.value) <= 0)) {
          errosPorSetor[setorNomeSelecionado].push(`Quantidade do item ${iIndex + 1} inválida`);
          qtdItem.classList.add('erro-campo');
        }
        if (unidadeItem && !unidadeItem.value.trim()) {
          errosPorSetor[setorNomeSelecionado].push(`Unidade de controle do item ${iIndex + 1} não preenchida`);
          unidadeItem.classList.add('erro-campo');
        }
      });
    });
    // Remover setores sem erros para evitar listar "Setor" sem itens de erro
    for (const key of Object.keys(errosPorSetor)) {
      if (!Array.isArray(errosPorSetor[key]) || errosPorSetor[key].length === 0) {
        delete errosPorSetor[key];
      }
    }



    if (Object.keys(errosPorSetor).length) {
      let msgHTML = "<h3>⚠️ Preencha os seguintes campos obrigatórios:</h3>";
      for (const setor in errosPorSetor) {
        msgHTML += `<strong>${setor}</strong><ul>`;
        errosPorSetor[setor].forEach(err => {
          msgHTML += `<li>${err}</li>`;
        });
        msgHTML += "</ul>";
      }
      const painel = document.getElementById('mensagensErros');
      if (painel) {
        painel.innerHTML = msgHTML;
        painel.style.display = 'block';
        painel.scrollIntoView({ behavior: 'smooth', block: 'start' });
      }
      const primeiroErro = document.querySelector('.erro-campo');
      if (primeiroErro) {
        try { primeiroErro.focus(); } catch (_e) {}
      }
      return false;
    }
    return true;
  }

  function armarListeners() {
    const form = document.getElementById('pedidoForm') || document.querySelector('form');
    const enviarBtn = document.getElementById('enviarPedido') || document.querySelector('button[id*="enviar" i]') || document.querySelector('button[type="submit"]');

    if (form) {
      form.addEventListener('submit', function(e) {
        if (!validarFormulario()) {
          e.preventDefault();
          e.stopPropagation();
          e.stopImmediatePropagation();
        }
      }, true);
    }

    if (enviarBtn) {
      enviarBtn.addEventListener('click', function(e) {
        if (!validarFormulario()) {
          e.preventDefault();
          e.stopPropagation();
          e.stopImmediatePropagation();
        }
      }, true);
    }
  }

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', armarListeners);
  } else {
    armarListeners();
  }
})();
</script>
<script>
function isSetorValido(selectElement) {
  if (!selectElement) return false;
  const value = (selectElement.value || "").trim();
  return value !== "" && value !== "Selecione";
}
</script>
<script>
document.addEventListener("input", function(e) {
  if (e.target.classList.contains("erro-campo")) {
    e.target.classList.remove("erro-campo");
    e.target.style.backgroundColor = "";
    e.target.style.outline = "";
  }
});
document.addEventListener("change", function(e) {
  if (e.target.classList.contains("erro-campo")) {
    e.target.classList.remove("erro-campo");
    e.target.style.backgroundColor = "";
    e.target.style.outline = "";
  }
});
</script>

<script>
(function() {
  var container = document.getElementById('setoresContainer');
  var enviar = document.getElementById('enviarPedido');
  if (!container || !enviar) return;

  function toggleEnviar() {
    try {
      enviar.style.display = (container.children && container.children.length > 0) ? 'inline-block' : 'none';
    } catch(e) {}
  }

  // Verificação inicial (caso a página carregue sem setores)
  toggleEnviar();

  // Observa adições/remoções diretas de setores
  var observer = new MutationObserver(function() {
    toggleEnviar();
  });
  observer.observe(container, { childList: true });

  // (Opcional) expõe função global segura para uso em outros pontos do código
  window.__toggleEnviarPedido__ = toggleEnviar;
})();
</script>

<!-- Firebase integração -->



<script>
document.addEventListener("DOMContentLoaded", function() {
  const btnEnviar = document.getElementById("enviarPedido");
  if (btnEnviar) {
    btnEnviar.addEventListener("click", function(e) {
      e.preventDefault();
      if (btnEnviar.disabled) return;
      btnEnviar.disabled = true;

      // Chama a função original de envio, se existir
      if (typeof enviarPedido === "function") {
        enviarPedido();
      }

      // Reativa depois de alguns segundos para permitir novo envio
      setTimeout(() => { btnEnviar.disabled = false; }, 5000);
    }, { once: false });
  }
});
</script>


<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
  import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCdB4pI610z1rplKmfAHct7CmGD0vmBg3U",
    authDomain: "almoxarifadobotucatu-5e03d.firebaseapp.com",
    projectId: "almoxarifadobotucatu-5e03d",
    storageBucket: "almoxarifadobotucatu-5e03d.firebasestorage.app",
    messagingSenderId: "828951000388",
    appId: "1:828951000388:web:06dbe3cb5764872e7b1311"
  };

  // Inicializa Firebase e Firestore
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  async function enviarPedido() {
    const solicitante = document.getElementById("solicitante").value.trim();
    const unidade = document.getElementById("unidade").value.trim();
    const itens = [];

    document.querySelectorAll(".item").forEach(itemDiv => {
      const nome = itemDiv.querySelector(".item-nome")?.value;
      const quantidade = itemDiv.querySelector(".item-qtd")?.value;
      const unidadeControle = itemDiv.querySelector(".item-unidade")?.value;
      if (nome && quantidade && unidadeControle) {
        itens.push({ nome, quantidade, unidadeControle });
      }
    });

    if (!solicitante || !unidade || itens.length === 0) {
      alert("⚠️ Preencha todos os campos e adicione pelo menos um item.");
      return;
    }

    const dados = {
      solicitante,
      unidade,
      itens,
      data: new Date().toISOString()
    };

    try {
      await addDoc(collection(db, "pedidos"), dados);
      alert("✅ Pedido enviado com sucesso!");
      document.getElementById("pedidoForm").reset();
      document.getElementById("setoresContainer").innerHTML = "";
    } catch (erro) {
      console.error("Erro ao salvar no Firebase:", erro);
      alert("❌ Erro ao enviar o pedido. Tente novamente.");
    }
  }

  // Listener único para o botão
  const btn = document.getElementById("enviarPedido");
  if (btn) {
    btn.addEventListener("click", async (e) => {
      e.preventDefault();
      if (btn.disabled) return;
      btn.disabled = true;
      await enviarPedido();
      setTimeout(() => { btn.disabled = false; }, 2000);
    });
  }
</script>


<script>
function atualizarUnidade() {
  const select = document.getElementById("medicamento");
  const valor = select.value;
  if (!valor) return;
  const match = valor.match(/unidade:\s*([^"]+)/i);
  if (match) {
    document.getElementById("unidadeControle").value = match[1].trim();
  }
}
</script>


<script>
function atualizarUnidade(selectElement) {
  const valor = selectElement.value;
  if (!valor) return;
  const match = valor.match(/unidade:\\s*([^"]+)/i);
  if (match) {
    const unidadeInput = selectElement.closest(".item-row").querySelector(".unidadeControle");
    if (unidadeInput) {
      unidadeInput.value = match[1].trim();
    }
  }
}
</script>


<script>
function atualizarUnidade(selectElement) {
  const valor = selectElement.value;
  if (!valor) return;

  const match = valor.match(/unidade:\s*([^"]+)/i);
  if (match) {
    const unidadeInput = selectElement.closest(".item-row").querySelector(".unidadeControle");
    if (unidadeInput) {
      unidadeInput.value = match[1].trim();
    }
  }
}
</script>



\n
<style>
  .ocultar { display: none !important; }
</style>
<script>
(function() {
  function parseUnidade(texto) {
    if (!texto) return "";
    const m = String(texto).match(/unidade:\s*"?([^",]+)"?/i);
    return m ? m[1].trim() : "";
  }

  function obterLinhaItem(el) {
    return el.closest(".item-row") || el.closest(".linha-item") || el.closest(".item") || el.parentElement;
  }

  function garantirHidden(linha) {
    if (!linha) return {};
    let unidadeSelect = linha.querySelector('select.unidadeControle, select[id*="unidadeControle"], select[name*="unidade"]');
    if (unidadeSelect) {
      const parentBox = unidadeSelect.closest("div");
      if (parentBox) {
        parentBox.style.display = "none"; // Oculta a caixa inteira
      } else {
        unidadeSelect.style.display = "none";
      }
    }
    const labels = linha.querySelectorAll("label");
    labels.forEach(l => {
      if (/Unidade\s*de\s*Controle/i.test(l.textContent)) {
        const parentBox = l.closest("div");
        if (parentBox) {
          parentBox.style.display = "none"; // Oculta a caixa inteira do label
        } else {
          l.style.display = "none";
        }
      }
    });
    let hidden = linha.querySelector("input.unidadeControleHidden");
    if (!hidden) {
      hidden = document.createElement("input");
      hidden.type = "hidden";
      hidden.name = (unidadeSelect && unidadeSelect.name) ? unidadeSelect.name : "unidadeControle[]";
      hidden.className = "unidadeControleHidden";
      linha.appendChild(hidden);
    }
    return { unidadeSelect, hidden };
  }

  function atualizarAPartirDoItem(selectEl) {
    const linha = obterLinhaItem(selectEl);
    const refs = garantirHidden(linha);
    const valorOption = selectEl.value || (selectEl.options && selectEl.options[selectEl.selectedIndex] ? selectEl.options[selectEl.selectedIndex].text : "");
    const unidade = parseUnidade(valorOption);
    if (refs && refs.hidden) {
      refs.hidden.value = unidade || "";
    }
  }

  function inicializarLinha(linha) {
    if (!linha) return;
    garantirHidden(linha);
    const itemSelect = linha.querySelector(".medicamento, select[id*='medicamento'], select[name*='medicamento']");
    if (itemSelect && !itemSelect.dataset._listenerBound) {
      itemSelect.addEventListener("change", function() { atualizarAPartirDoItem(itemSelect); });
      itemSelect.dataset._listenerBound = "1";
      atualizarAPartirDoItem(itemSelect);
    }
  }

  function inicializarPagina() {
    document.querySelectorAll(".item-row, .linha-item, .item").forEach(inicializarLinha);
    document.addEventListener("change", function(e) {
      if (e.target && (e.target.matches(".medicamento") || e.target.matches("select[id*='medicamento']") || e.target.matches("select[name*='medicamento']"))) {
        atualizarAPartirDoItem(e.target);
      }
    });
    const obs = new MutationObserver(function(mutations) {
      mutations.forEach(function(m) {
        m.addedNodes.forEach(function(node) {
          if (!(node instanceof Element)) return;
          if (node.matches(".item-row, .linha-item, .item")) {
            inicializarLinha(node);
          } else {
            node.querySelectorAll && node.querySelectorAll(".item-row, .linha-item, .item").forEach(inicializarLinha);
          }
        });
      });
    });
    obs.observe(document.body, { childList: true, subtree: true });
  }

  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", inicializarPagina);
  } else {
    inicializarPagina();
  }
})();
</script>

</body>
</html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<title>Rodapé Profissional Pequeno</title>

<footer>
    © 2025.Todos os direitos reservados.
  </footer>
<!-- Firebase integração -->



<script>
document.addEventListener("DOMContentLoaded", function() {
  const btnEnviar = document.getElementById("enviarPedido");
  if (btnEnviar) {
    btnEnviar.addEventListener("click", function(e) {
      e.preventDefault();
      if (btnEnviar.disabled) return;
      btnEnviar.disabled = true;

      // Chama a função original de envio, se existir
      if (typeof enviarPedido === "function") {
        enviarPedido();
      }

      // Reativa depois de alguns segundos para permitir novo envio
      setTimeout(() => { btnEnviar.disabled = false; }, 5000);
    }, { once: false });
  }
});
</script>


<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
  import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCdB4pI610z1rplKmfAHct7CmGD0vmBg3U",
    authDomain: "almoxarifadobotucatu-5e03d.firebaseapp.com",
    projectId: "almoxarifadobotucatu-5e03d",
    storageBucket: "almoxarifadobotucatu-5e03d.firebasestorage.app",
    messagingSenderId: "828951000388",
    appId: "1:828951000388:web:06dbe3cb5764872e7b1311"
  };

  // Inicializa Firebase e Firestore
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  async function enviarPedido() {
    const solicitante = document.getElementById("solicitante").value.trim();
    const unidade = document.getElementById("unidade").value.trim();
    const itens = [];

    document.querySelectorAll(".item").forEach(itemDiv => {
      const nome = itemDiv.querySelector(".item-nome")?.value;
      const quantidade = itemDiv.querySelector(".item-qtd")?.value;
      const unidadeControle = itemDiv.querySelector(".item-unidade")?.value;
      if (nome && quantidade && unidadeControle) {
        itens.push({ nome, quantidade, unidadeControle });
      }
    });

    if (!solicitante || !unidade || itens.length === 0) {
      alert("⚠️ Preencha todos os campos e adicione pelo menos um item.");
      return;
    }

    const dados = {
      solicitante,
      unidade,
      itens,
      data: new Date().toISOString()
    };

    try {
      await addDoc(collection(db, "pedidos"), dados);
      alert("✅ Pedido enviado com sucesso!");
      document.getElementById("pedidoForm").reset();
      document.getElementById("setoresContainer").innerHTML = "";
    } catch (erro) {
      console.error("Erro ao salvar no Firebase:", erro);
      alert("❌ Erro ao enviar o pedido. Tente novamente.");
    }
  }

  // Listener único para o botão
  const btn = document.getElementById("enviarPedido");
  if (btn) {
    btn.addEventListener("click", async (e) => {
      e.preventDefault();
      if (btn.disabled) return;
      btn.disabled = true;
      await enviarPedido();
      setTimeout(() => { btn.disabled = false; }, 2000);
    });
  }
</script>


<script>
function atualizarUnidade() {
  const select = document.getElementById("medicamento");
  const valor = select.value;
  if (!valor) return;
  const match = valor.match(/unidade:\s*([^"]+)/i);
  if (match) {
    document.getElementById("unidadeControle").value = match[1].trim();
  }
}
</script>


<script>
function atualizarUnidade(selectElement) {
  const valor = selectElement.value;
  if (!valor) return;
  const match = valor.match(/unidade:\\s*([^"]+)/i);
  if (match) {
    const unidadeInput = selectElement.closest(".item-row").querySelector(".unidadeControle");
    if (unidadeInput) {
      unidadeInput.value = match[1].trim();
    }
  }
}
</script>


<script>
function atualizarUnidade(selectElement) {
  const valor = selectElement.value;
  if (!valor) return;

  const match = valor.match(/unidade:\s*([^"]+)/i);
  if (match) {
    const unidadeInput = selectElement.closest(".item-row").querySelector(".unidadeControle");
    if (unidadeInput) {
      unidadeInput.value = match[1].trim();
    }
  }
}
</script>



\n
<style>
  .ocultar { display: none !important; }
</style>
<script>
(function() {
  function parseUnidade(texto) {
    if (!texto) return "";
    const m = String(texto).match(/unidade:\s*"?([^",]+)"?/i);
    return m ? m[1].trim() : "";
  }

  function obterLinhaItem(el) {
    return el.closest(".item-row") || el.closest(".linha-item") || el.closest(".item") || el.parentElement;
  }

  function garantirHidden(linha) {
    if (!linha) return {};
    let unidadeSelect = linha.querySelector('select.unidadeControle, select[id*="unidadeControle"], select[name*="unidade"]');
    if (unidadeSelect) {
      const parentBox = unidadeSelect.closest("div");
      if (parentBox) {
        parentBox.style.display = "none"; // Oculta a caixa inteira
      } else {
        unidadeSelect.style.display = "none";
      }
    }
    const labels = linha.querySelectorAll("label");
    labels.forEach(l => {
      if (/Unidade\s*de\s*Controle/i.test(l.textContent)) {
        const parentBox = l.closest("div");
        if (parentBox) {
          parentBox.style.display = "none"; // Oculta a caixa inteira do label
        } else {
          l.style.display = "none";
        }
      }
    });
    let hidden = linha.querySelector("input.unidadeControleHidden");
    if (!hidden) {
      hidden = document.createElement("input");
      hidden.type = "hidden";
      hidden.name = (unidadeSelect && unidadeSelect.name) ? unidadeSelect.name : "unidadeControle[]";
      hidden.className = "unidadeControleHidden";
      linha.appendChild(hidden);
    }
    return { unidadeSelect, hidden };
  }

  function atualizarAPartirDoItem(selectEl) {
    const linha = obterLinhaItem(selectEl);
    const refs = garantirHidden(linha);
    const valorOption = selectEl.value || (selectEl.options && selectEl.options[selectEl.selectedIndex] ? selectEl.options[selectEl.selectedIndex].text : "");
    const unidade = parseUnidade(valorOption);
    if (refs && refs.hidden) {
      refs.hidden.value = unidade || "";
    }
  }

  function inicializarLinha(linha) {
    if (!linha) return;
    garantirHidden(linha);
    const itemSelect = linha.querySelector(".medicamento, select[id*='medicamento'], select[name*='medicamento']");
    if (itemSelect && !itemSelect.dataset._listenerBound) {
      itemSelect.addEventListener("change", function() { atualizarAPartirDoItem(itemSelect); });
      itemSelect.dataset._listenerBound = "1";
      atualizarAPartirDoItem(itemSelect);
    }
  }

  function inicializarPagina() {
    document.querySelectorAll(".item-row, .linha-item, .item").forEach(inicializarLinha);
    document.addEventListener("change", function(e) {
      if (e.target && (e.target.matches(".medicamento") || e.target.matches("select[id*='medicamento']") || e.target.matches("select[name*='medicamento']"))) {
        atualizarAPartirDoItem(e.target);
      }
    });
    const obs = new MutationObserver(function(mutations) {
      mutations.forEach(function(m) {
        m.addedNodes.forEach(function(node) {
          if (!(node instanceof Element)) return;
          if (node.matches(".item-row, .linha-item, .item")) {
            inicializarLinha(node);
          } else {
            node.querySelectorAll && node.querySelectorAll(".item-row, .linha-item, .item").forEach(inicializarLinha);
          }
        });
      });
    });
    obs.observe(document.body, { childList: true, subtree: true });
  }

  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", inicializarPagina);
  } else {
    inicializarPagina();
  }
})();
</script>

</body></html></head></html>
