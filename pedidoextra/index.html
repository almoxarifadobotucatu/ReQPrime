<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <title>Solicitação de Pedido Extra</title>
</head>
<body>
  <div class="container" id="mainContainer">
    <h2>Solicitação de Pedido Extra</h2>
    <div id="mensagensErros"></div>
    <form id="pedidoForm">
      <label for="solicitante">Responsável pela solicitação:</label>
      <input autocomplete="off" id="solicitante" required type="text"/>
      <label for="unidade">Unidade de saúde:</label>
      <input autocomplete="off" id="unidade" required type="text"/>
      <div id="setoresContainer"></div>
      <div class="buttons">
        <button onclick="adicionarSetor()" type="button">Adicionar novo setor</button>
        <button id="enviarPedido" type="button">Enviar pedido</button>
      </div>
    </form>
  </div>

  <datalist id="lista-itens"></datalist>

  <script>
    // Todas as listas originais de itens (trecho reduzido para demonstração)
    const farmaciaItems = [
     "1 01 06 0001 7 Aciclovir 200mg unidade: Comprimido",
     "1 01 06 0002 5 Aciclovir 50MG/G – Creme Bisnaga c/ 10G – Uso Tópico unidade: Bisnaga",
     "1 01 20 0417 9 Ácido Acético 15% - Frasco 50 ML unidade: Frasco",
     "1 01 20 0030 0 Ácido Acético 3% - Frasco 10ML – Manipulado unidade: Frasco",
     "1 01 20 0047 5 Ácido Acético 5% - Frasco 10ML – Manipulado unidade: Frasco",
     "1 01 03 0001 3 Ácido acetilsalicílico 100mg unidade: Comprimido",
     "1 01 03 0006 4 Ácido acetilsalicílico 500mg unidade: Comprimido",
     "1 01 09 0001 0 Ácido fólico 5mg unidade: Comprimido"
    ];

    const PsicotópicoItems = [
     "1 01 16 0007 0 Ácido valpróico 250mg - Cápsula unidade: Cápsula",
     "1 01 16 0008 8 Ácido valpróico 250mg/5ml - Frasco 100ml unidade: Frasco",
     "1 01 16 0009 6 Ácido valpróico 500mg - Comprimido revestido unidade: Comprimido",
     "1 01 16 0001 0 Amitriptilina, cloridrato 25mg unidade: Comprimido"
    ];

    // Preenche o datalist sem exibir "unidade: ..."
    function carregarListaItens() {
      const datalist = document.getElementById("lista-itens");
      datalist.innerHTML = "";

      [...farmaciaItems, ...PsicotópicoItems].forEach(item => {
        const option = document.createElement("option");
        option.value = item.replace(/\s+unidade:\s*[A-Za-zÀ-ú]+$/i, "");
        option.dataset.original = item;
        datalist.appendChild(option);
      });
    }

    // Preenche a unidade de controle automaticamente
    function preencherUnidadeControle(itemSelecionado, unidadeControleInput) {
      const datalist = document.getElementById("lista-itens");
      const option = [...datalist.options].find(opt => opt.value === itemSelecionado);
      const original = option ? option.dataset.original : itemSelecionado;

      const match = original.match(/unidade:\s*([A-Za-zÀ-ú]+)/i);
      unidadeControleInput.value = match ? match[1] : "";
    }

    // Executa ao carregar
    carregarListaItens();
  </script>
</body>
</html>
